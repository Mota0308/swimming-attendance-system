# 手機 API 測試指南

## 概述
本指南說明如何在手機上測試API連接，驗證REST API與MongoDB數據庫的連接是否正常工作。

## 🚀 快速開始

### 1. 構建APK
```bash
# 在Android_app目錄下執行
./gradlew assembleDebug
```

### 2. 安裝APK
將生成的APK文件安裝到手機上：
- 路徑：`Android_app/app/build/outputs/apk/debug/app-debug.apk`
- 確保手機允許安裝未知來源的應用

### 3. 啟動測試
1. 打開應用
2. 進入"API連接測試"頁面
3. 點擊測試按鈕

## 📱 測試功能

### 1. 配置信息檢查
- 顯示當前API配置
- 驗證配置是否有效
- 檢查基礎URL和API密鑰

### 2. API連接測試
- 測試與服務器的連接
- 驗證API密鑰是否正確
- 檢查網絡連接狀態

### 3. 學生資料測試
- 從雲端獲取學生資料
- 顯示學生數量
- 顯示前3名學生信息

### 4. 用戶登入測試
- 測試用戶認證功能
- 驗證登入API端點
- 檢查錯誤處理

## 🔧 配置說明

### API 配置
```kotlin
// 生產環境配置
private const val DEFAULT_BASE_URL = "http://203.145.95.240:3000"
private const val DEFAULT_PUBLIC_API_KEY = "ttdrcccy"
private const val DEFAULT_PRIVATE_API_KEY = "2b207365-cbf0-4e42-a3bf-f932c84557c4"
```

### 網絡安全配置
已配置以下域名允許HTTP連接：
- `203.145.95.240` - API服務器
- `cluster0.0dhi0qc.mongodb.net` - MongoDB Atlas
- `10.0.2.2` - Android模擬器

## 📋 測試步驟

### 步驟1：檢查配置
1. 打開應用
2. 點擊"📋 顯示配置信息"
3. 確認以下信息正確：
   - 基礎URL: `http://203.145.95.240:3000`
   - 公開密鑰: `ttdrcccy`
   - 私有密鑰: `2b207365-cbf0-4e42-a3bf-f932c84557c4`
   - 配置狀態: ✅ 有效

### 步驟2：測試連接
1. 點擊"🧪 測試API連接"
2. 等待測試完成
3. 檢查結果：
   - ✅ 成功：API連接正常
   - ❌ 失敗：檢查網絡連接和服務器狀態

### 步驟3：測試學生資料
1. 點擊"📥 測試獲取學生資料"
2. 等待數據加載
3. 檢查結果：
   - 顯示學生數量
   - 顯示前3名學生信息

### 步驟4：測試登入
1. 點擊"🔐 測試用戶登入"
2. 等待測試完成
3. 檢查結果：
   - 預期結果：登入失敗（測試用戶不存在）
   - 這表示API端點正常工作

## 🔍 故障排除

### 1. 網絡連接問題
**症狀**: API連接測試失敗
**解決方案**:
- 檢查手機網絡連接
- 確認可以訪問 `http://203.145.95.240:3000`
- 檢查防火牆設置

### 2. API密鑰問題
**症狀**: 連接成功但返回401錯誤
**解決方案**:
- 確認API密鑰正確
- 檢查請求頭設置
- 驗證服務器配置

### 3. 數據解析問題
**症狀**: 連接成功但無法獲取數據
**解決方案**:
- 檢查JSON格式
- 驗證數據庫連接
- 查看服務器日誌

### 4. 權限問題
**症狀**: 應用無法訪問網絡
**解決方案**:
- 確認已授予網絡權限
- 檢查網絡安全配置
- 重啟應用

## 📊 預期結果

### 成功情況
```
📋 API 配置信息

基礎URL: http://203.145.95.240:3000
公開密鑰: ttdrcccy
私有密鑰: 2b207365***
數據庫: test

配置狀態: ✅ 有效

🧪 測試API連接
✅ API連接成功
API 服務器運行正常

📥 測試獲取學生資料
✅ 成功獲取學生資料
學生數量: 3

前3名學生:
• 張小明 (0912345678)
• 李小華 (0923456789)
• 王小強 (0934567890)

🔐 測試用戶登入
⚠️ 登入測試失敗
用戶名或密碼錯誤
(這是預期結果，因為測試用戶不存在)
```

### 失敗情況
```
❌ API連接失敗
連接超時

或

❌ 獲取學生資料異常
網絡連接錯誤
```

## 🛠️ 調試技巧

### 1. 查看日誌
使用Android Studio的Logcat查看詳細日誌：
```bash
adb logcat | grep "APITest"
```

### 2. 網絡測試
在手機瀏覽器中測試API：
```
http://203.145.95.240:3000/health
```

### 3. 配置檢查
確認以下文件配置正確：
- `APIConfig.kt` - API配置
- `network_security_config.xml` - 網絡安全配置
- `AndroidManifest.xml` - 權限配置

## 📱 不同環境配置

### 生產環境
```kotlin
private const val DEFAULT_BASE_URL = "http://203.145.95.240:3000"
```

### 本地開發
```kotlin
private const val DEFAULT_BASE_URL = "http://192.168.1.100:3000"
```

### Android模擬器
```kotlin
private const val DEFAULT_BASE_URL = "http://10.0.2.2:3000"
```

## 🎯 測試檢查清單

### 構建前檢查
- [ ] API服務器正在運行
- [ ] 網絡連接正常
- [ ] 配置信息正確
- [ ] 權限設置完整

### 測試檢查
- [ ] 配置信息顯示正確
- [ ] API連接測試通過
- [ ] 學生資料獲取成功
- [ ] 登入測試返回預期結果
- [ ] 錯誤處理正常工作

### 部署檢查
- [ ] APK安裝成功
- [ ] 應用啟動正常
- [ ] 所有功能測試通過
- [ ] 日誌記錄完整

## 📞 聯繫支持

如果遇到問題，請檢查：
1. 服務器狀態
2. 網絡連接
3. API配置
4. 應用權限

---

**版本**: 1.0.0  
**更新日期**: 2024年12月  
**適用於**: Android 手機測試 
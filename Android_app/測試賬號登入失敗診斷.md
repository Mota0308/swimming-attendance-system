# 測試賬號登入失敗診斷指南

## 🔍 問題描述

使用測試賬號（test/123456）登入時顯示"電話號碼或密碼錯誤"。

## 🎯 可能原因

### 1. APK版本問題
- **症狀**: 安裝的APK是舊版本，沒有包含修復
- **原因**: 代碼已更新但APK未重新構建
- **解決**: 重新構建並安裝新APK

### 2. API服務器問題
- **症狀**: 服務器沒有測試登入端點
- **原因**: 服務器代碼未更新或未重啟
- **解決**: 重啟API服務器

### 3. 網絡連接問題
- **症狀**: 無法連接到API服務器
- **原因**: 網絡配置或防火牆問題
- **解決**: 檢查網絡連接

## 🔧 診斷步驟

### 步驟1: 檢查API服務器

#### 1.1 驗證服務器狀態
```bash
# 在api-server目錄運行
.\fix-login-final.bat
```

#### 1.2 手動測試API
```bash
# 測試健康檢查
curl -H "x-api-public-key: ttdrcccy" -H "x-api-private-key: 2b207365-cbf0-4e42-a3bf-f932c84557c4" http://localhost:3001/health

# 測試登入端點
node quick-test.js
```

### 步驟2: 檢查Android應用

#### 2.1 確認代碼更新
檢查以下文件是否包含修復：
- `LoginActivity.kt` - 跳過連接測試
- `CloudAPIService.kt` - 使用測試登入端點

#### 2.2 重新構建APK
```bash
# 在Android_app目錄運行
.\build_fixed_apk.bat
```

### 步驟3: 安裝和測試

#### 3.1 安裝新APK
1. 將新APK傳輸到Android設備
2. 卸載舊版本（如果存在）
3. 安裝新APK

#### 3.2 測試登入
1. 啟動應用
2. 選擇家長版本
3. 輸入測試賬號：
   - 電話：test
   - 密碼：123456
4. 點擊登入

## 🧪 測試方案

### 測試賬號列表
| 電話號碼 | 密碼 | 用戶類型 | 狀態 |
|---------|------|----------|------|
| test | 123456 | parent | 待測試 |
| 0912345678 | 123456 | parent | 待測試 |
| admin | admin123 | parent | 待測試 |
| demo | demo123 | parent | 待測試 |

### 測試步驟
1. **API服務器測試**
   - 運行 `quick-test.js`
   - 確認返回成功響應

2. **Android應用測試**
   - 使用測試賬號登入
   - 檢查是否進入主界面

3. **錯誤日誌檢查**
   - 查看服務器控制台日誌
   - 查看Android應用日誌

## 🔍 故障排除

### 問題1: API服務器無響應
**症狀**: 測試腳本顯示連接錯誤
**解決方案**:
```bash
# 重啟API服務器
cd api-server
taskkill /f /im node.exe
node server.js
```

### 問題2: 測試登入端點不存在
**症狀**: 404錯誤
**解決方案**:
```bash
# 檢查服務器代碼
findstr /C:"auth/test-login" server.js
# 如果不存在，重新添加代碼
```

### 問題3: APK仍使用舊代碼
**症狀**: 登入時仍顯示"網絡連接失敗"
**解決方案**:
```bash
# 重新構建APK
cd Android_app
.\build_fixed_apk.bat
# 安裝新APK
```

### 問題4: 網絡連接問題
**症狀**: 連接超時
**解決方案**:
1. 檢查防火牆設置
2. 確認端口3001開放
3. 嘗試使用本地IP地址

## 📊 驗證清單

### API服務器驗證
- [ ] 服務器在端口3001運行
- [ ] 包含 `/auth/test-login` 端點
- [ ] 健康檢查端點響應正常
- [ ] 測試登入端點響應正常

### Android應用驗證
- [ ] 代碼已更新為跳過連接測試
- [ ] 使用 `/auth/test-login` 端點
- [ ] 新APK已構建
- [ ] 新APK已安裝

### 功能驗證
- [ ] 測試賬號可以登入
- [ ] 登入後進入主界面
- [ ] 錯誤提示正確
- [ ] 日誌顯示正常

## 🚨 緊急修復

如果問題持續存在：

1. **完全重啟系統**
2. **使用本地Wi-Fi網絡** (192.168.1.24:3001)
3. **檢查所有防火牆設置**
4. **重新安裝所有組件**

## 📝 日誌分析

### 服務器日誌關鍵詞
- `🧪 測試登入請求` - 測試登入端點被調用
- `✅ 測試用戶登入成功` - 登入成功
- `❌ 測試用戶登入失敗` - 登入失敗

### Android應用日誌關鍵詞
- `🔐 開始驗證用戶賬號` - 開始登入
- `✅ 用戶驗證成功` - 登入成功
- `❌ 用戶驗證異常` - 登入異常

---

**診斷時間**: 2025年1月8日  
**版本**: 1.0  
**狀態**: 待測試 
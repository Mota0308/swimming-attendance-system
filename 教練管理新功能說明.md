# 教練管理新功能說明

## 功能概述

根據您的需求，我已經成功為教練管理頁面添加了以下新功能：

### 1. 地點選擇功能
- **位置**：在教練管理頁面上方添加了"地點"下拉清單
- **功能**：可以選擇上課地點，支持手動添加新地點
- **操作**：點擊"+"按鈕可以添加新的地點選項

### 2. 教練列表彈出窗口
- **觸發**：點擊"教練列表"按鈕
- **功能**：彈出窗口顯示泳會和教練管理界面
- **泳會選擇**：窗口頂部有"泳會"下拉清單，支持手動添加新泳會
- **教練篩選**：選擇泳會後，顯示該泳會下的所有教練

### 3. 時間段管理
- **邏輯流程**：
  1. 選擇上課地點
  2. 選擇日期
  3. 點擊"教練列表"
  4. 選擇泳會
  5. 對某個教練進行時間段添加

### 4. 數據庫結構更新
- **Coach_account 集合**：添加了 `location` 和 `club` 字段
- **Coach_work_hours 集合**：添加了 `location` 和 `club` 字段
- **數據關聯**：每個教練記錄都包含地點和泳會信息

## 技術實現

### Android 應用修改

#### 1. 布局文件更新
- `activity_admin_main.xml`：添加地點選擇器和教練列表按鈕
- `dialog_coach_list.xml`：新增教練列表彈出窗口布局
- `dialog_add_location.xml`：新增添加地點對話框布局
- `dialog_add_club.xml`：新增添加泳會對話框布局

#### 2. 代碼功能實現
- `AdminMainActivity.kt`：
  - 添加地點和泳會數據管理
  - 實現地點選擇器功能
  - 實現教練列表彈出窗口
  - 支持按泳會篩選教練
  - 更新上傳工時功能，包含地點和泳會信息

#### 3. API 服務更新
- `CloudAPIService.kt`：
  - 更新教練工時上傳API，支持地點和泳會參數
  - 更新教練列表獲取API，支持按泳會篩選

### 後端服務修改

#### 1. API 服務器更新
- `server.js`：
  - 更新教練註冊API，支持地點和泳會字段
  - 更新教練工時上傳API，支持地點和泳會參數
  - 更新教練列表獲取API，支持按泳會篩選

#### 2. 桌面應用更新
- `main.js`：
  - 更新教練創建功能，支持地點和泳會字段
  - 更新工時保存功能，支持地點和泳會參數

## 預設數據

### 地點列表
- 維多利亞公園游泳池
- 荔枝角公園游泳池
- 觀塘游泳池
- 深水埗公園游泳池
- 九龍公園游泳池

### 泳會列表
- 維多利亞泳會
- 荔枝角泳會
- 觀塘泳會
- 深水埗泳會
- 九龍泳會

## 使用流程

### 1. 基本操作流程
1. 進入教練管理頁面
2. 選擇上課地點（可手動添加新地點）
3. 選擇日期
4. 點擊"教練列表"按鈕
5. 在彈出窗口中選擇泳會（可手動添加新泳會）
6. 查看該泳會下的教練列表
7. 為教練添加時間段
8. 點擊"上傳教練工時"保存數據

### 2. 添加新地點
1. 點擊地點選擇器旁的"+"按鈕
2. 在彈出窗口中輸入新地點名稱
3. 點擊"確認"保存

### 3. 添加新泳會
1. 在教練列表彈出窗口中點擊泳會選擇器旁的"+"按鈕
2. 在彈出窗口中輸入新泳會名稱
3. 點擊"確認"保存

## 數據庫結構

### Coach_account 集合
```javascript
{
  _id: ObjectId,
  studentName: String,    // 教練姓名
  phone: String,          // 電話號碼
  password: String,       // 密碼
  location: String,       // 地點（新增）
  club: String,           // 泳會（新增）
  createdAt: Date,        // 創建時間
  createdDate: String     // 創建日期
}
```

### Coach_work_hours 集合
```javascript
{
  _id: ObjectId,
  phone: String,          // 教練電話
  date: String,           // 日期
  hours: Number,          // 工時
  location: String,       // 地點（新增）
  club: String,           // 泳會（新增）
  createdAt: Date,        // 創建時間
  updatedAt: Date         // 更新時間
}
```

## 測試驗證

已創建測試腳本驗證所有功能：
- `test-new-coach-features.js`：測試新功能
- `check-database-structure.js`：檢查和更新數據庫結構

所有測試均已通過，功能正常工作。

## 注意事項

1. **數據遷移**：現有數據已自動添加 `location` 和 `club` 字段（默認為空字符串）
2. **向後兼容**：新功能不會影響現有功能的使用
3. **數據驗證**：上傳工時時會檢查是否已選擇地點
4. **錯誤處理**：所有新增功能都包含適當的錯誤處理和用戶提示

## 總結

新功能已完全按照您的需求實現：
- ✅ 添加了地點下拉清單（支持手動添加）
- ✅ 添加了教練列表按鈕和彈出窗口
- ✅ 添加了泳會下拉清單（支持手動添加）
- ✅ 實現了按泳會篩選教練的功能
- ✅ 更新了數據庫結構，添加了 `location` 和 `club` 字段
- ✅ 實現了完整的操作流程：地點 → 日期 → 教練列表 → 泳會 → 時間段添加

所有功能都經過測試驗證，可以正常使用。 
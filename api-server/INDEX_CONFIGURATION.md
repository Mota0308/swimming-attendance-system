# ç´¢å¼•é…ç½®èªªæ˜

## ğŸ“‹ ç´¢å¼•é…ç½®åŸå‰‡

### âœ… æ­£ç¢ºé…ç½®
- **Student_account.studentId**: å”¯ä¸€ç´¢å¼•ï¼ˆç¨€ç–ç´¢å¼•ï¼‰
- **students_timeslot.studentId**: éå”¯ä¸€ç´¢å¼•ï¼ˆä¸€å€‹å­¸ç”Ÿå¯æœ‰å¤šæ¢è¨˜éŒ„ï¼‰

### âŒ éŒ¯èª¤é…ç½®
- **studentPhone**: ä¸æ‡‰è©²ä½œç‚ºå”¯ä¸€ç´¢å¼•ï¼ˆä»»ä½•é›†åˆä¸­éƒ½ä¸æ‡‰è©²ï¼‰

## ğŸ” å„é›†åˆç´¢å¼•é…ç½®

### 1. Student_account é›†åˆ

| ç´¢å¼•åç¨± | å­—æ®µ | é¡å‹ | èªªæ˜ |
|---------|------|------|------|
| `_id_` | `_id` | ä¸»éµ | MongoDBè‡ªå‹•ç”Ÿæˆ |
| `idx_phone` | `phone` | å”¯ä¸€ç´¢å¼•ï¼ˆç¨€ç–ï¼‰ | ç”¨æ–¼å¿«é€ŸæŸ¥æ‰¾å­¸ç”Ÿï¼Œå…è¨±null |
| `idx_studentId` | `studentId` | **å”¯ä¸€ç´¢å¼•ï¼ˆç¨€ç–ï¼‰** | âœ… **ä¸»è¦å”¯ä¸€æ¨™è­˜** |
| `idx_name` | `name` | æ™®é€šç´¢å¼• | ç”¨æ–¼æœç´¢ |

**é—œéµé»**ï¼š
- âœ… `studentId` æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œç¢ºä¿æ¯å€‹å­¸ç”Ÿåªæœ‰ä¸€å€‹ID
- âœ… `phone` æ˜¯å”¯ä¸€ç´¢å¼•ï¼ˆç¨€ç–ï¼‰ï¼Œå…è¨±nullå€¼

### 2. students_timeslot é›†åˆ

| ç´¢å¼•åç¨± | å­—æ®µ | é¡å‹ | èªªæ˜ |
|---------|------|------|------|
| `_id_` | `_id` | ä¸»éµ | MongoDBè‡ªå‹•ç”Ÿæˆ |
| `idx_studentId` | `studentId` | **éå”¯ä¸€ç´¢å¼•** | âœ… ä¸€å€‹å­¸ç”Ÿå¯æœ‰å¤šæ¢è¨˜éŒ„ |
| `idx_studentId_classDate` | `studentId + classDate` | è¤‡åˆç´¢å¼•ï¼ˆéå”¯ä¸€ï¼‰ | å¿«é€ŸæŸ¥è©¢ç‰¹å®šå­¸ç”Ÿçš„ç‰¹å®šæ—¥æœŸè¨˜éŒ„ |
| `idx_studentPhone_classDate` | `studentPhone + classDate` | è¤‡åˆç´¢å¼•ï¼ˆéå”¯ä¸€ï¼‰ | é€šéé›»è©±æŸ¥è©¢ï¼ˆå†—ä½™å­—æ®µï¼‰ |
| `idx_classDate_location` | `classDate + location` | è¤‡åˆç´¢å¼• | æŒ‰æ—¥æœŸå’Œåœ°é»æŸ¥è©¢ |

**é—œéµé»**ï¼š
- âœ… `studentId` **ä¸æ˜¯å”¯ä¸€ç´¢å¼•**ï¼Œå› ç‚ºä¸€å€‹å­¸ç”Ÿå¯ä»¥æœ‰å¤šæ¢æ™‚æ®µè¨˜éŒ„
- âœ… `studentPhone` **ä¸æ˜¯å”¯ä¸€ç´¢å¼•**ï¼Œå› ç‚ºæœƒé‡è¤‡
- âœ… ä½¿ç”¨è¤‡åˆç´¢å¼•å„ªåŒ–æŸ¥è©¢æ€§èƒ½

## ğŸ¯ ç‚ºä»€éº¼é€™æ¨£é…ç½®ï¼Ÿ

### studentId ä½œç‚ºå”¯ä¸€ç´¢å¼•ï¼ˆStudent_accountï¼‰

```javascript
// Student_account é›†åˆ
{
  studentId: "00000001",  // âœ… å”¯ä¸€ç´¢å¼•
  phone: "12345678",
  name: "å¼µä¸‰"
}
```

**åŸå› **ï¼š
- æ¯å€‹å­¸ç”Ÿåªæœ‰ä¸€å€‹ `studentId`
- ç¢ºä¿æ•¸æ“šå”¯ä¸€æ€§å’Œå®Œæ•´æ€§
- ç”¨æ–¼å¿«é€ŸæŸ¥æ‰¾å’Œé—œè¯

### studentId ä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼ˆstudents_timeslotï¼‰

```javascript
// students_timeslot é›†åˆ
[
  { studentId: "00000001", classDate: "2025-11-06", ... },  // ç¬¬ä¸€æ¢è¨˜éŒ„
  { studentId: "00000001", classDate: "2025-11-13", ... },  // ç¬¬äºŒæ¢è¨˜éŒ„
  { studentId: "00000001", classDate: "2025-11-20", ... }   // ç¬¬ä¸‰æ¢è¨˜éŒ„
]
```

**åŸå› **ï¼š
- ä¸€å€‹å­¸ç”Ÿå¯ä»¥æœ‰å¤šæ¢æ™‚æ®µè¨˜éŒ„
- å¦‚æœè¨­ç½®ç‚ºå”¯ä¸€ç´¢å¼•ï¼Œæœƒé˜»æ­¢é€™ç¨®æ­£å¸¸çš„æ•¸æ“šçµæ§‹
- ä½¿ç”¨éå”¯ä¸€ç´¢å¼• + è¤‡åˆç´¢å¼•ä¾†å„ªåŒ–æŸ¥è©¢

### studentPhone ä¸ä½œç‚ºå”¯ä¸€ç´¢å¼•

**åŸå› **ï¼š
1. **åœ¨ Student_account ä¸­**ï¼šä½¿ç”¨ `phone` å­—æ®µï¼ˆä¸æ˜¯ `studentPhone`ï¼‰
2. **åœ¨ students_timeslot ä¸­**ï¼š`studentPhone` æ˜¯å†—ä½™å­—æ®µï¼Œæœƒé‡è¤‡
3. **ä»»ä½•åœ°æ–¹éƒ½ä¸æ‡‰è©²**ï¼š`studentPhone` ä½œç‚ºå”¯ä¸€ç´¢å¼•æœƒå°è‡´éŒ¯èª¤

## ğŸ“Š æŸ¥è©¢å ´æ™¯ç¤ºä¾‹

### å ´æ™¯1ï¼šé€šé studentId æŸ¥è©¢å­¸ç”Ÿä¿¡æ¯
```javascript
// ä½¿ç”¨å”¯ä¸€ç´¢å¼•ï¼Œå¿«é€ŸæŸ¥æ‰¾
db.Student_account.findOne({ studentId: "00000001" })
```

### å ´æ™¯2ï¼šæŸ¥è©¢å­¸ç”Ÿçš„æ‰€æœ‰æ™‚æ®µè¨˜éŒ„
```javascript
// ä½¿ç”¨éå”¯ä¸€ç´¢å¼•ï¼Œè¿”å›å¤šæ¢è¨˜éŒ„
db.students_timeslot.find({ studentId: "00000001" })
```

### å ´æ™¯3ï¼šæŸ¥è©¢å­¸ç”Ÿåœ¨ç‰¹å®šæ—¥æœŸçš„è¨˜éŒ„
```javascript
// ä½¿ç”¨è¤‡åˆç´¢å¼•ï¼Œå¿«é€ŸæŸ¥è©¢
db.students_timeslot.find({ 
  studentId: "00000001",
  classDate: ISODate("2025-11-06")
})
```

## ğŸ”§ ç¶­è­·è…³æœ¬

### å‰µå»ºç´¢å¼•
```bash
npm run create-indexes
```

### é©—è­‰ç´¢å¼•
```bash
npm run verify-indexes
```

### ä¿®å¾©ç´¢å¼•
```bash
npm run fix:studentphone-index
```

## âœ… é©—è­‰çµæœ

é‹è¡Œ `npm run verify-indexes` æ‡‰è©²çœ‹åˆ°ï¼š

```
ğŸ“Š Student_account é›†åˆç´¢å¼•ï¼š
  - idx_studentId: {"studentId":1} - âœ… å”¯ä¸€ï¼ˆç¨€ç–ï¼‰
    âœ… studentId æ˜¯å”¯ä¸€ç´¢å¼•ï¼ˆæ­£ç¢ºï¼‰

ğŸ“Š students_timeslot é›†åˆç´¢å¼•ï¼š
  - idx_studentId: {"studentId":1} - âŒ éå”¯ä¸€
    âœ… studentId ç´¢å¼•ä¸æ˜¯å”¯ä¸€ç´¢å¼•ï¼ˆæ­£ç¢ºï¼Œä¸€å€‹å­¸ç”Ÿå¯æœ‰å¤šæ¢è¨˜éŒ„ï¼‰
```

## ğŸ“ ç¸½çµ

| é›†åˆ | å­—æ®µ | ç´¢å¼•é¡å‹ | æ˜¯å¦å”¯ä¸€ | åŸå›  |
|------|------|---------|---------|------|
| Student_account | studentId | å–®å­—æ®µç´¢å¼• | âœ… æ˜¯ | æ¯å€‹å­¸ç”Ÿåªæœ‰ä¸€å€‹ID |
| students_timeslot | studentId | å–®å­—æ®µç´¢å¼• | âŒ å¦ | ä¸€å€‹å­¸ç”Ÿå¯æœ‰å¤šæ¢è¨˜éŒ„ |
| students_timeslot | studentId + classDate | è¤‡åˆç´¢å¼• | âŒ å¦ | å„ªåŒ–æŸ¥è©¢æ€§èƒ½ |
| students_timeslot | studentPhone | ä»»ä½•ç´¢å¼• | âŒ å¦ | å†—ä½™å­—æ®µï¼Œæœƒé‡è¤‡ |

---

**é…ç½®æ—¥æœŸ**ï¼š2025-02-06
**ç‹€æ…‹**ï¼šâœ… å·²é©—è­‰æ­£ç¢º

























<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; connect-src 'self' https://swimming-attendance-system-production.up.railway.app https://cdnjs.cloudflare.com; img-src 'self' data: https:; object-src 'none'; base-uri 'self'; form-action 'self';">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='30' fill='%23667eea'/%3E%3Ctext x='32' y='38' text-anchor='middle' font-size='28' fill='white'%3E%F0%9F%8F%8B%EF%B8%8F%3C/text%3E%3C/svg%3E">
    <title>游泳系統 - 管理平台</title>
    
    <!-- 預載入關鍵資源 -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Inter:wght@400;500;600;700&display=swap" as="style">
    <link rel="preload" href="styles.css?v=9" as="style">
    <link rel="preload" href="database-connector.js?v=29" as="script">
    <link rel="preload" href="main-app.js?v=45" as="script">
    
    <!-- DNS預解析 -->
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="dns-prefetch" href="//swimming-attendance-system-production.up.railway.app">
    
    <!-- 關鍵CSS內聯，避免阻塞渲染 -->
    <style>
        /* 關鍵渲染路徑CSS */
        body { margin: 0; font-family: 'Inter', sans-serif; }
        .hidden { display: none !important; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .loading-spinner { color: white; text-align: center; }
        .section { display: none; }
        .section.active { display: block; }
        .login-container { max-width: 400px; margin: 50px auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        .login-btn { width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; }
        
        /* 優化字體載入 */
        .font-loading { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .font-loaded { font-family: 'Inter', sans-serif; }
    </style>
    
    <!-- 非關鍵CSS異步載入 -->
    <link rel="stylesheet" href="styles.css?v=9">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- 登入界面 -->
    <div id="loginSection" class="section active">
        <div class="login-container">
            <div class="login-header">
                <h1><i class="fas fa-swimming-pool"></i> 游泳系統</h1>
                <p>管理平台</p>
            </div>
            
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="phoneInput">
                        <i class="fas fa-phone"></i> 電話號碼
                    </label>
                    <input type="tel" id="phoneInput" name="phone" required placeholder="請輸入電話號碼">
                </div>
                
                <div class="form-group">
                    <label for="passwordInput">
                        <i class="fas fa-lock"></i> 密碼
                    </label>
                    <input type="password" id="passwordInput" name="password" required placeholder="請輸入密碼">
                </div>
                
                <div class="form-group">
                    <label for="roleSelect">
                        <i class="fas fa-user-tag"></i> 登入身份
                    </label>
                    <select id="roleSelect" name="role">
                        <option value="parent">學生</option>
                        <option value="coach" selected>教練</option>
                        <option value="supervisor">主管</option>
                        <option value="admin">文書職員</option>
                        <option value="manager">管理員</option>
                    </select>
                </div>
                
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> 登入
                </button>
            </form>
            
            <div id="loginMessage" class="message"></div>
            
            <div class="login-footer">
                <p>© 2025 游泳系統</p>
            </div>
        </div>
    </div>

    <!-- 教練主界面 -->
    <div id="coachSection" class="section">
        <nav class="top-nav">
            <div class="nav-left">
                <button class="sidebar-toggle-btn" onclick="toggleSidebar('coach')">
                    <i class="fas fa-bars"></i>
                </button>
                <h2><i class="fas fa-swimming-pool"></i> 游泳系統</h2>
            </div>
            <div class="nav-right">
                <div class="user-info">
                    <span id="userPhone"></span>
                    <span id="userType"></span>
                </div>
                <button id="logoutBtn" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> 登出
                </button>
            </div>
        </nav>

        <div class="page-layout">
            <!-- 左側導航欄 -->
            <aside id="coachSidebar" class="sidebar">
                <div class="sidebar-header">
                    <h3><i class="fas fa-swimming-pool"></i> 功能選單</h3>
                </div>
                <nav class="sidebar-nav">
                    <a href="#" class="sidebar-item" data-feature="attendance">
                        <i class="fas fa-clipboard-check"></i>
                        <span>出席管理</span>
                    </a>
                    <a href="#" class="sidebar-item" data-feature="work-hours">
                        <i class="fas fa-clock"></i>
                        <span>工時管理</span>
                    </a>
                    <a href="#" class="sidebar-item" data-feature="roster">
                        <i class="fas fa-calendar-alt"></i>
                        <span>教練更表</span>
                    </a>
                    <a href="#" class="sidebar-item" data-feature="personal-settings">
                        <i class="fas fa-user-cog"></i>
                        <span>個人設置</span>
                    </a>
                </nav>
            </aside>

            <!-- 主內容區域 -->
            <div class="main-content-wrapper">
                <div class="main-content">
            <!-- 出席管理界面 -->
            <div id="attendanceInterface" class="interface-section hidden">
                <div class="interface-header">
                    <h3><i class="fas fa-clipboard-check"></i> 出席管理</h3>
                    <button id="backToMain" class="back-btn">
                        <i class="fas fa-arrow-left"></i> 返回主選單
                    </button>
                </div>
                
                <div class="attendance-controls">
                    <div class="control-group">
                        <label>地點</label>
                        <select id="attendanceLocation">
                            <option value="">全部地點</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>日期</label>
                        <input type="date" id="attendanceDate">
                    </div>
                    <button id="refreshAttendance" class="refresh-btn">
                        <i class="fas fa-sync"></i> 刷新
                    </button>
                    <button id="deleteAttendance" class="btn-danger" style="margin-left: 10px;">
                        <i class="fas fa-trash"></i> 刪除
                    </button>
                    <button id="confirmDeleteAttendance" class="btn-success" style="margin-left: 10px; display: none;">
                        <i class="fas fa-check"></i> 確認
                    </button>
                    <button id="cancelDeleteAttendance" class="btn-secondary" style="margin-left: 10px; display: none;">
                        <i class="fas fa-times"></i> 取消
                    </button>
                </div>
                
                <div id="attendanceTable" class="attendance-table">
                    <!-- 出席表格將在這裡動態生成 -->
                </div>
            </div>

            <!-- 工時管理界面 -->
            <div id="workHoursInterface" class="interface-section hidden">
                <div class="interface-header">
                    <h3><i class="fas fa-clock"></i> 工時管理</h3>
                    <button id="backToMain2" class="back-btn">
                        <i class="fas fa-arrow-left"></i> 返回主選單
                    </button>
                </div>
                
                <!-- 工時管理控制面板 -->
                <div class="work-hours-controls">
                    <div class="control-group">
                        <label for="coachWorkHoursYearSelect">年份：</label>
                        <select id="coachWorkHoursYearSelect" onchange="WorkHoursFunctions.onDateChange()">
                            <!-- 動態生成選項 -->
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="coachWorkHoursMonthSelect">月份：</label>
                        <select id="coachWorkHoursMonthSelect" onchange="WorkHoursFunctions.onDateChange()">
                            <!-- 動態生成選項 -->
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="coachWorkHoursLocationFilter">地點篩選：</label>
                        <div id="coachWorkHoursLocationFilter" class="filter-checkbox-container" style="max-height: 150px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 6px; padding: 8px; background: white; min-width: 150px;">
                            <!-- 選項將動態生成為複選框 -->
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label for="coachWorkHoursClubFilter">泳會篩選：</label>
                        <div id="coachWorkHoursClubFilter" class="filter-checkbox-container" style="max-height: 150px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 6px; padding: 8px; background: white; min-width: 150px;">
                            <!-- 選項將動態生成為複選框 -->
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button onclick="WorkHoursFunctions.loadWorkHoursData()" class="btn-primary">
                            <i class="fas fa-download"></i> 載入工時
                    </button>
                        <button onclick="WorkHoursFunctions.exportCurrentEmployee()" class="btn-secondary">
                            <i class="fas fa-file-excel"></i> 導出
                    </button>
                    </div>
                </div>
                
                <!-- 工時表格容器 -->
                <div id="coachWorkHoursTableContainer" class="work-hours-table-container">
                    <!-- 工時表格將在這裡動態生成 -->
                </div>
            </div>

            <!-- 教練更表界面 -->
            <div id="rosterInterface" class="interface-section hidden">
                <div class="interface-header">
                    <h3 id="rosterSectionTitle"><i class="fas fa-calendar-alt"></i> 教練更表</h3>
                    <button class="back-btn" onclick="hideAllFeatures()">
                        <i class="fas fa-arrow-left"></i> 返回主選單
                    </button>
                </div>
                
                <!-- 新的更表控制面板 -->
                <div class="roster-controls">
                    <div class="control-group">
                        <label for="rosterCoachSelect">選擇員工：</label>
                        <select id="rosterCoachSelect">
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="rosterMonth">月份選擇：</label>
                        <select id="rosterMonth" onchange="onCoachRosterMonthChange()">
                            <!-- 動態生成選項：當前月份前4個月到後6個月 -->
                        </select>
                    </div>
                    
                    <div class="button-group">
                        <button class="roster-btn load-btn" onclick="loadRosterData()">
                            <i class="fas fa-download"></i> 載入更表
                        </button>
                    </div>
                </div>
                
                <!-- 工作类型提示 -->
                <div id="workTypeIndicator" class="work-type-indicator">
                    <span id="workTypeText">工作類型：未知</span>
                    <div id="workTypeInstructions" class="instructions">
                        <!-- 根据工作类型显示不同的说明 -->
                    </div>
                </div>
                
                
                <!-- 更表日历 -->
                <div id="rosterCalendar" class="roster-calendar">
                    <!-- 日历将在这里动态生成 -->
                </div>
                
                <!-- 提交状态显示 -->
                <div id="submitStatus" class="submit-status hidden">
                    <div class="status-message">
                        <i class="fas fa-check-circle"></i>
                        <span>更表已提交成功</span>
                    </div>
                </div>
            </div>

            <!-- 個人設置界面 -->
            <div id="personalSettingsInterface" class="interface-section hidden">
                <div class="interface-header">
                    <h3><i class="fas fa-user-cog"></i> 個人設置</h3>
                    <button class="back-btn" onclick="hideAllFeatures()">
                        <i class="fas fa-arrow-left"></i> 返回主選單
                    </button>
                </div>
                
                <div id="personalSettingsContainer" class="personal-settings-container">
                    <div class="settings-section">
                        <h4>基本信息</h4>
                        <div class="form-group">
                            <label for="settingsName">姓名：</label>
                            <input type="text" id="settingsName" class="form-control">
                </div>
                        <div class="form-group">
                            <label for="settingsPhone">電話號碼：</label>
                            <input type="text" id="settingsPhone" class="form-control">
            </div>
                        <div class="form-group">
                            <label for="settingsEmail">電子郵箱：</label>
                            <input type="email" id="settingsEmail" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="settingsPassword">登入密碼：</label>
                            <input type="password" id="settingsPassword" class="form-control" placeholder="留空表示不修改">
                        </div>
                        <div class="form-group">
                            <label for="settingsAddress">地址：</label>
                            <input type="text" id="settingsAddress" class="form-control" placeholder="請輸入地址">
                        </div>
                        <div class="form-group">
                            <label for="settingsIdCard">身份證號碼：</label>
                            <input type="text" id="settingsIdCard" class="form-control" placeholder="請輸入身份證號碼">
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h4>銀行信息</h4>
                        <div class="form-group">
                            <label for="settingsBankName">所屬銀行名稱：</label>
                            <input type="text" id="settingsBankName" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="settingsBankAccount">銀行賬戶：</label>
                            <input type="text" id="settingsBankAccount" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="settingsBankCard">銀行卡：</label>
                            <input type="text" id="settingsBankCard" class="form-control" placeholder="請輸入銀行卡名稱">
                        </div>
                        <div class="form-group">
                            <label for="settingsBankCardNumber">銀行卡號：</label>
                            <input type="text" id="settingsBankCardNumber" class="form-control" placeholder="請輸入銀行卡號">
                        </div>
                    </div>
                    
                    <div class="settings-actions">
                        <button id="saveSettingsBtn" class="btn-primary">
                            <i class="fas fa-save"></i> 保存設置
                        </button>
                    </div>
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
<!-- 主管頁面 -->
<div id="supervisorSection" class="section">
    <nav class="top-nav">
        <div class="nav-left">
            <button class="sidebar-toggle-btn" onclick="toggleSidebar('supervisor')">
                <i class="fas fa-bars"></i>
            </button>
            <h2><i class="fas fa-user-tie"></i> 游泳系統 - 主管管理</h2>
        </div>
        <div class="nav-right">
            <div class="user-info">
                <span id="userPhone"></span>
                <span id="userType"></span>
            </div>
            <button id="supervisorLogoutBtn" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i> 登出
            </button>
        </div>
    </nav>

    <div class="page-layout">
        <!-- 左側導航欄 -->
        <aside id="supervisorSidebar" class="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-user-tie"></i> 功能選單</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="sidebar-item" data-feature="supervisor-attendance">
                    <i class="fas fa-clipboard-check"></i>
                    <span>出席管理</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="supervisor-work-hours">
                    <i class="fas fa-clock"></i>
                    <span>工時管理</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="supervisor-roster">
                    <i class="fas fa-calendar-alt"></i>
                    <span>教練更表</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="supervisor-reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>報表管理</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="data-management">
                    <i class="fas fa-database"></i>
                    <span>資料管理</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="supervisor-personal-settings">
                    <i class="fas fa-user-cog"></i>
                    <span>個人設置</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="employee-create">
                    <i class="fas fa-user-plus"></i>
                    <span>員工創建</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="trial-create">
                    <i class="fas fa-swimming-pool"></i>
                    <span>試堂創建</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="bill-create">
                    <i class="fas fa-file-invoice"></i>
                    <span>賬單創建</span>
                </a>
            </nav>
        </aside>

        <!-- 主內容區域 -->
        <div class="main-content-wrapper">
            <div class="main-content">
        <!-- 主管工時管理界面 -->
        <div id="supervisorWorkHoursSection" class="interface-section hidden">
            <div class="interface-header">
                <h3><i class="fas fa-clock"></i> 主管工時管理</h3>
                <button class="back-btn" onclick="hideAllFeatures()">
                    <i class="fas fa-arrow-left"></i> 返回主選單
                </button>
            </div>
            
            <!-- 工時管理控制面板 -->
            <div class="work-hours-controls">
                <div class="control-group">
                    <label for="supervisorWorkHoursEmployeeSelect">員工：</label>
                    <select id="supervisorWorkHoursEmployeeSelect" onchange="WorkHoursFunctions.onEmployeeChange()">
                        <!-- 動態生成選項 -->
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="supervisorWorkHoursYearSelect">年份：</label>
                    <select id="supervisorWorkHoursYearSelect" onchange="WorkHoursFunctions.onDateChange()">
                        <!-- 動態生成選項 -->
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="supervisorWorkHoursMonthSelect">月份：</label>
                    <select id="supervisorWorkHoursMonthSelect" onchange="WorkHoursFunctions.onDateChange()">
                        <!-- 動態生成選項 -->
                    </select>
                </div>
                <div class="control-group">
                    <label for="supervisorWorkHoursLocationFilter">地點篩選：</label>
                    <div id="supervisorWorkHoursLocationFilter" class="filter-checkbox-container" style="max-height: 150px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 6px; padding: 8px; background: white; min-width: 150px;">
                        <!-- 選項將動態生成為複選框 -->
                    </div>
                </div>
                <div class="control-group">
                    <label for="supervisorWorkHoursClubFilter">泳會篩選：</label>
                    <div id="supervisorWorkHoursClubFilter" class="filter-checkbox-container" style="max-height: 150px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 6px; padding: 8px; background: white; min-width: 150px;">
                        <!-- 選項將動態生成為複選框 -->
                    </div>
                </div>
            
                
                <div class="button-group">
                    <button onclick="WorkHoursFunctions.loadWorkHoursData()" class="btn-primary">
                        <i class="fas fa-download"></i> 載入工時
                    </button>
                    <button onclick="WorkHoursFunctions.exportAllWorkHours()" class="btn-secondary">
                        <i class="fas fa-file-excel"></i> 導出
                    </button>
                    <button onclick="WorkHoursFunctions.loadFilteredWorkHours()" class="btn-secondary">
                        <i class="fas fa-filter"></i> 篩選顯示
                    </button>
            </div>
            </div>
            
            <!-- 工時表格容器 -->
            <div id="supervisorWorkHoursTableContainer" class="work-hours-table-container">
                <!-- 工時表格將在這裡動態生成 -->
            </div>
            <!-- 篩選結果列表 -->
            <div id="supervisorWorkHoursFilteredList" class="work-hours-table-container"></div>
        </div>

        <!-- 主管更表管理界面 -->
        <div id="supervisorRosterSection" class="interface-section hidden">
            <div class="interface-header">
                <h3><i class="fas fa-calendar-alt"></i> 主管更表管理</h3>
                <button class="back-btn" onclick="hideAllFeatures()">
                    <i class="fas fa-arrow-left"></i> 返回主選單
                </button>
            </div>
            
            <!-- 教練選擇控制面板 -->
            <div class="roster-controls">
                <div class="control-group">
                    <label for="staffCoachSelect">選擇員工：</label>
                    <select id="staffCoachSelect" onchange="onChangeStaffCoach()">
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="rosterMonth">月份選擇：</label>
                    <select id="rosterMonth" onchange="onRosterMonthChange()">
                        <!-- 月份選項將動態生成 -->
                    </select>
                </div>
                
                <div class="button-group">
                    <button id="batchOperationBtn" type="button" class="btn-primary" onclick="openBatchOperationModal()">
                        <i class="fas fa-tasks"></i> 批量操作
                    </button>
                </div>
            </div>
            
            <!-- 教練更表日曆容器 -->
            <div id="staffRosterCalendars" class="roster-calendar">
                <!-- 教練更表日曆將在這裡動態生成 -->
            </div>
            
            <!-- 批量修改模态框 -->
            <div id="batchModifyModal" class="batch-modal hidden" onclick="handleBatchModifyModalClick(event)">
                <div class="batch-modal-content" onclick="event.stopPropagation()">
                    <div class="batch-modal-header">
                        <h3><i class="fas fa-edit"></i> 批量修改</h3>
                        <button class="batch-modal-close" onclick="closeBatchModifyModal()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="batch-modal-body">
                        <!-- 步驟1: 日期范围选择 -->
                        <div class="batch-section">
                            <h4>1. 选择日期范围</h4>
                            <div class="batch-date-range-row">
                                <div class="date-input-group">
                                    <label for="batchModifyStartDate">开始日期</label>
                                    <input type="date" id="batchModifyStartDate" onchange="onBatchModifyDateRangeChange()">
                                </div>
                                <span class="date-range-separator">至</span>
                                <div class="date-input-group">
                                    <label for="batchModifyEndDate">结束日期</label>
                                    <input type="date" id="batchModifyEndDate" onchange="onBatchModifyDateRangeChange()">
                                </div>
                                <button type="button" class="btn-secondary btn-sm" onclick="resetBatchModifyDateRangeToMonth()">整月</button>
                            </div>
                            <div id="batchModifyDateRangeDisplay" class="batch-date-range-display">
                                尚未选择日期范围
                            </div>
                        </div>
                        
                        <!-- 步驟2: 操作类型选择 -->
                        <div class="batch-section">
                            <h4>2. 选择操作类型</h4>
                            <div class="batch-operation-type-group">
                                <button type="button" class="batch-operation-type-btn active" data-mode="fill" onclick="selectBatchModifyOperationType('fill')">
                                    <i class="fas fa-fill-drip"></i>
                                    <span>批量填充</span>
                                </button>
                                <button type="button" class="batch-operation-type-btn" data-mode="leave" onclick="selectBatchModifyOperationType('leave')">
                                    <i class="fas fa-plane-departure"></i>
                                    <span>批量请假</span>
                                </button>
                                <button type="button" class="batch-operation-type-btn" data-mode="clear" onclick="selectBatchModifyOperationType('clear')">
                                    <i class="fas fa-eraser"></i>
                                    <span>批量清除</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- 步驟3: 假期类型选择（仅请假模式） -->
                        <div id="batchModifyLeaveTypeSection" class="batch-section hidden">
                            <h4>3. 选择假期类型</h4>
                            <div class="leave-type-selector">
                                <button type="button" class="leave-type-btn" data-leave-type="regular" onclick="selectBatchModifyLeaveType('regular')">
                                    例假
                                </button>
                                <button type="button" class="leave-type-btn" data-leave-type="annual" onclick="selectBatchModifyLeaveType('annual')">
                                    年假
                                </button>
                                <button type="button" class="leave-type-btn" data-leave-type="maternity" onclick="selectBatchModifyLeaveType('maternity')">
                                    产假
                                </button>
                                <button type="button" class="leave-type-btn" data-leave-type="sick" onclick="selectBatchModifyLeaveType('sick')">
                                    病假
                                </button>
                                <button type="button" class="leave-type-btn" data-leave-type="nopaid" onclick="selectBatchModifyLeaveType('nopaid')">
                                    No Paid
                                </button>
                                <button type="button" class="leave-type-btn leave-type-btn-muted" data-leave-type="statutory" onclick="selectBatchModifyLeaveType('statutory')">
                                    法定劳工假
                                </button>
                            </div>

                            <div id="batchModifyLeaveSettings">
                                <!-- 例假设置 -->
                                <div id="batchModifyRegularLeaveSettings" class="leave-type-settings hidden">
                                    <h5 style="margin-top: 0;">例假设置</h5>
                                    <div class="form-group" style="margin-bottom: 12px;">
                                        <label>日期时间段：</label>
                                        <div class="date-range-inline">
                                            <input type="date" id="batchModifyRegularLeaveStartDate" class="form-control" onchange="onBatchModifyRegularLeaveDateChange()">
                                            <span>至</span>
                                            <input type="date" id="batchModifyRegularLeaveEndDate" class="form-control" onchange="onBatchModifyRegularLeaveDateChange()">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>选择星期：</label>
                                        <div class="weekday-selector">
                                            <button type="button" class="weekday-btn" data-weekday="0" onclick="selectBatchModifyRegularLeaveWeekday(0)">日</button>
                                            <button type="button" class="weekday-btn" data-weekday="1" onclick="selectBatchModifyRegularLeaveWeekday(1)">一</button>
                                            <button type="button" class="weekday-btn" data-weekday="2" onclick="selectBatchModifyRegularLeaveWeekday(2)">二</button>
                                            <button type="button" class="weekday-btn" data-weekday="3" onclick="selectBatchModifyRegularLeaveWeekday(3)">三</button>
                                            <button type="button" class="weekday-btn" data-weekday="4" onclick="selectBatchModifyRegularLeaveWeekday(4)">四</button>
                                            <button type="button" class="weekday-btn" data-weekday="5" onclick="selectBatchModifyRegularLeaveWeekday(5)">五</button>
                                            <button type="button" class="weekday-btn" data-weekday="6" onclick="selectBatchModifyRegularLeaveWeekday(6)">六</button>
                                        </div>
                                    </div>
                                    <div class="info-box warning" style="margin-top: 12px;">
                                        <i class="fas fa-info-circle"></i> 提示：选择日期时间段和星期后，系统会自动在日历中高亮显示该时间段内所有对应星期的日期。
                                    </div>
                                </div>
                                
                                <!-- 其他假期类型说明 -->
                                <div id="batchModifyManualLeaveSettings" class="leave-type-settings hidden">
                                    <div class="info-box info">
                                        <i class="fas fa-info-circle"></i> 请在下方日历中手动点击选择日期。已选择的日期会以不同颜色高亮显示。
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 步驟4: 日期选择区域 -->
                        <div id="batchModifyCalendarSection" class="batch-section hidden">
                            <h4>4. 选择日期（点击日历上的日期进行选择）</h4>
                            <div class="batch-date-selection-info">
                                <span id="batchModifySelectedDatesCount">已选择：0个日期</span>
                                <button class="btn-secondary btn-sm" onclick="clearBatchModifySelection()">清空选择</button>
                                <button class="btn-secondary btn-sm" onclick="selectBatchModifyWeekdays()">选择工作日</button>
                                <button class="btn-secondary btn-sm" onclick="selectBatchModifyWeekends()">选择周末</button>
                            </div>
                            
                            <!-- 批量修改日历 -->
                            <div id="batchModifyCalendar" class="batch-calendar-container">
                                <!-- 日历将在这里动态生成 -->
                            </div>
                            
                            <div id="batchModifySelectedDatesList" class="batch-selected-dates-list">
                                <p class="batch-hint">已选择的日期：</p>
                            </div>
                        </div>
                        
                        <!-- 步驟5: 批量填充设置 -->
                        <div id="batchModifyFillSettings" class="batch-section">
                            <h4>5. 设置填充内容</h4>
                            <div class="batch-slot-selection">
                                <label>选择要填充的时段：</label>
                                <div class="batch-checkbox-group">
                                    <label><input type="checkbox" id="batchModifySlot1" checked> 上午时段</label>
                                    <label><input type="checkbox" id="batchModifySlot2" checked> 中午时段</label>
                                    <label><input type="checkbox" id="batchModifySlot3" checked> 下午时段</label>
                                </div>
                            </div>
                            
                            <div class="batch-time-location-settings">
                                <div class="batch-slot-setting">
                                    <h5>上午时段设置</h5>
                                    <div class="form-group">
                                        <label>时间：</label>
                                        <div class="time-selector-group" style="display: flex; gap: 8px; align-items: center;">
                                            <select class="roster-time-start-hour form-control" style="width: 80px;" data-slot="1">
                                                <option value="">時</option>
                                            </select>
                                            <span>:</span>
                                            <select class="roster-time-start-min form-control" style="width: 80px;" data-slot="1">
                                                <option value="">分</option>
                                            </select>
                                            <span>-</span>
                                            <select class="roster-time-end-hour form-control" style="width: 80px;" data-slot="1">
                                                <option value="">時</option>
                                            </select>
                                            <span>:</span>
                                            <select class="roster-time-end-min form-control" style="width: 80px;" data-slot="1">
                                                <option value="">分</option>
                                            </select>
                                            <input type="hidden" id="batchModifyTime1" class="roster-time" data-slot="1">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>地点：</label>
                                        <select id="batchModifyLocation1" class="form-control">
                                            <option value="">请选择地点</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="batch-slot-setting">
                                    <h5>中午时段设置</h5>
                                    <div class="form-group">
                                        <label>时间：</label>
                                        <div class="time-selector-group" style="display: flex; gap: 8px; align-items: center;">
                                            <select class="roster-time-start-hour form-control" style="width: 80px;" data-slot="2">
                                                <option value="">時</option>
                                            </select>
                                            <span>:</span>
                                            <select class="roster-time-start-min form-control" style="width: 80px;" data-slot="2">
                                                <option value="">分</option>
                                            </select>
                                            <span>-</span>
                                            <select class="roster-time-end-hour form-control" style="width: 80px;" data-slot="2">
                                                <option value="">時</option>
                                            </select>
                                            <span>:</span>
                                            <select class="roster-time-end-min form-control" style="width: 80px;" data-slot="2">
                                                <option value="">分</option>
                                            </select>
                                            <input type="hidden" id="batchModifyTime2" class="roster-time" data-slot="2">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>地点：</label>
                                        <select id="batchModifyLocation2" class="form-control">
                                            <option value="">请选择地点</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="batch-slot-setting">
                                    <h5>下午时段设置</h5>
                                    <div class="form-group">
                                        <label>时间：</label>
                                        <div class="time-selector-group" style="display: flex; gap: 8px; align-items: center;">
                                            <select class="roster-time-start-hour form-control" style="width: 80px;" data-slot="3">
                                                <option value="">時</option>
                                            </select>
                                            <span>:</span>
                                            <select class="roster-time-start-min form-control" style="width: 80px;" data-slot="3">
                                                <option value="">分</option>
                                            </select>
                                            <span>-</span>
                                            <select class="roster-time-end-hour form-control" style="width: 80px;" data-slot="3">
                                                <option value="">時</option>
                                            </select>
                                            <span>:</span>
                                            <select class="roster-time-end-min form-control" style="width: 80px;" data-slot="3">
                                                <option value="">分</option>
                                            </select>
                                            <input type="hidden" id="batchModifyTime3" class="roster-time" data-slot="3">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>地点：</label>
                                        <select id="batchModifyLocation3" class="form-control">
                                            <option value="">请选择地点</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="batch-conflict-handling">
                                <label>处理冲突：</label>
                                <label class="batch-radio-option">
                                    <input type="radio" name="batchModifyConflict" value="overwrite" checked>
                                    <span>覆盖已有数据</span>
                                </label>
                                <label class="batch-radio-option">
                                    <input type="radio" name="batchModifyConflict" value="skip">
                                    <span>跳过已有数据的日期</span>
                                </label>
                                <label class="batch-radio-option">
                                    <input type="radio" name="batchModifyConflict" value="blank">
                                    <span>仅填充空白时段</span>
                                </label>
                            </div>
                        </div>
                        
                        
                        <!-- 步驟5: 批量清除设置 -->
                        <div id="batchModifyClearSettings" class="batch-section hidden">
                            <h4>5. 设置清除内容</h4>
                            <div class="batch-slot-selection">
                                <label>选择要清除的时段：</label>
                                <div class="batch-checkbox-group">
                                    <label><input type="checkbox" id="batchModifyClearSlot1" checked> 上午时段</label>
                                    <label><input type="checkbox" id="batchModifyClearSlot2" checked> 中午时段</label>
                                    <label><input type="checkbox" id="batchModifyClearSlot3" checked> 下午时段</label>
                                </div>
                            </div>
                            <div class="batch-checkbox-group">
                                <label>
                                    <input type="checkbox" id="batchModifyClearTime" checked>
                                    <span>清除时间</span>
                                </label>
                                <label>
                                    <input type="checkbox" id="batchModifyClearLocation" checked>
                                    <span>清除地点</span>
                                </label>
                                <label>
                                    <input type="checkbox" id="batchModifyClearLeave" checked>
                                    <span>清除请假状态</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- 步驟6: 预览区域 -->
                        <div id="batchModifyPreview" class="batch-section hidden">
                            <h4>6. 预览操作结果</h4>
                            <div id="batchModifyPreviewContent" class="batch-preview-content">
                                <!-- 预览内容将在这里动态生成 -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="batch-modal-footer">
                        <button class="btn-secondary" onclick="closeBatchModifyModal()">取消</button>
                        <button class="btn-secondary" onclick="previewBatchModifyOperation()">预览</button>
                        <button class="btn-primary" onclick="executeBatchModifyOperation()" id="batchModifyExecuteBtn" disabled>
                            <i class="fas fa-check"></i> 确认执行
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 教練更表統計功能 -->
            <div class="roster-statistics-section">
                <h4><i class="fas fa-chart-bar"></i> 月份更表</h4>
                
                <div class="statistics-controls">
                    <div class="control-group">
                        <label for="statsMonth">統計月份：</label>
                        <select id="statsMonth">
                            <option value="1">1月</option>
                            <option value="2">2月</option>
                            <option value="3">3月</option>
                            <option value="4">4月</option>
                            <option value="5">5月</option>
                            <option value="6">6月</option>
                            <option value="7">7月</option>
                            <option value="8" selected>8月</option>
                            <option value="9">9月</option>
                            <option value="10">10月</option>
                            <option value="11">11月</option>
                            <option value="12">12月</option>
                        </select>
                    </div>
                    
                    <button class="refresh-btn" onclick="renderAllCoachesRoster()">
                        <i class="fas fa-chart-bar"></i> 顯示更表
                    </button>
                    
                    <button class="export-btn" onclick="exportLocationStats()">
                        <i class="fas fa-download"></i> 導出更表
                    </button>
                </div>
                
                <!-- 統計結果顯示區域 -->
                <div id="dailyLocationStats" class="daily-stats-container empty">
                    <div class="empty">點擊「顯示更表」按鈕開始顯示月份更表</div>
                </div>
            </div>
        </div>

        <!-- 主管出席管理界面 -->
        <div id="supervisorAttendanceSection" class="interface-section hidden">
            <div class="interface-header">
                <h3><i class="fas fa-clipboard-check"></i> 主管出席管理</h3>
                <button class="back-btn" onclick="hideAllFeatures()">
                    <i class="fas fa-arrow-left"></i> 返回主選單
                </button>
            </div>
            <div class="supervisor-attendance-content">
                <div class="attendance-controls">
                    <div class="control-group">
                        <label>日期</label>
                        <input type="date" id="supervisorAttendanceDate">
                    </div>
                    <div class="control-group">
                        <label>地點</label>
                        <select id="supervisorAttendanceLocation">
                            <option value="">全部地點</option>
                        </select>
                    </div>
                    <button id="refreshSupervisorAttendance" class="refresh-btn">
                        <i class="fas fa-sync"></i> 刷新
                    </button>
                    <button id="deleteSupervisorAttendance" class="btn-danger" style="margin-left: 10px;">
                        <i class="fas fa-trash"></i> 刪除
                    </button>
                    <button id="confirmDeleteSupervisorAttendance" class="btn-success" style="margin-left: 10px; display: none;">
                        <i class="fas fa-check"></i> 確認
                    </button>
                    <button id="cancelDeleteSupervisorAttendance" class="btn-secondary" style="margin-left: 10px; display: none;">
                        <i class="fas fa-times"></i> 取消
                    </button>
                    <button id="createPendingClassSupervisorAttendance" class="btn-primary" style="margin-left: 10px;">
                        <i class="fas fa-plus-circle"></i> 待約創建
                    </button>
                </div>
                <div id="supervisorAttendanceTable" class="attendance-table">
                    <!-- 出席表格將在這裡動態生成 -->
                </div>
            </div>
        </div>

        <!-- 主管報表管理界面 -->
        <div id="supervisorReportsSection" class="interface-section hidden">
            <div class="interface-header">
                <h3><i class="fas fa-chart-bar"></i> 主管報表管理</h3>
                <button class="back-btn" onclick="hideAllFeatures()">
                    <i class="fas fa-arrow-left"></i> 返回主選單
                </button>
            </div>
            <div class="supervisor-reports-content">
                <!-- 主管報表管理內容 -->
            </div>
        </div>

        <!-- 主管個人設置界面 -->
        <div id="supervisorPersonalSettingsSection" class="interface-section hidden">
            <div class="interface-header">
                <h3><i class="fas fa-user-cog"></i> 個人設置</h3>
                <button class="back-btn" onclick="hideAllFeatures()">
                    <i class="fas fa-arrow-left"></i> 返回主選單
                </button>
            </div>
            
            <div id="supervisorPersonalSettingsContainer" class="personal-settings-container">
                <div class="settings-section">
                    <h4>基本信息</h4>
                    <div class="form-group">
                        <label for="supervisorSettingsName">姓名：</label>
                        <input type="text" id="supervisorSettingsName" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="supervisorSettingsPhone">電話號碼：</label>
                        <input type="text" id="supervisorSettingsPhone" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="supervisorSettingsEmail">電子郵箱：</label>
                        <input type="email" id="supervisorSettingsEmail" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="supervisorSettingsPassword">登入密碼：</label>
                        <input type="password" id="supervisorSettingsPassword" class="form-control" placeholder="留空表示不修改">
                    </div>
                    <div class="form-group">
                        <label for="supervisorSettingsAddress">地址：</label>
                        <input type="text" id="supervisorSettingsAddress" class="form-control" placeholder="請輸入地址">
                    </div>
                    <div class="form-group">
                        <label for="supervisorSettingsIdCard">身份證號碼：</label>
                        <input type="text" id="supervisorSettingsIdCard" class="form-control" placeholder="請輸入身份證號碼">
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>銀行信息</h4>
                    <div class="form-group">
                        <label for="supervisorSettingsBankName">所屬銀行名稱：</label>
                        <input type="text" id="supervisorSettingsBankName" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="supervisorSettingsBankAccount">銀行賬戶：</label>
                        <input type="text" id="supervisorSettingsBankAccount" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="supervisorSettingsBankCard">銀行卡：</label>
                        <input type="text" id="supervisorSettingsBankCard" class="form-control" placeholder="請輸入銀行卡名稱">
                    </div>
                    <div class="form-group">
                        <label for="supervisorSettingsBankCardNumber">銀行卡號：</label>
                        <input type="text" id="supervisorSettingsBankCardNumber" class="form-control" placeholder="請輸入銀行卡號">
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button id="supervisorSaveSettingsBtn" class="btn-primary">
                        <i class="fas fa-save"></i> 保存設置
                    </button>
                </div>
            </div>
        </div>

        <!-- 員工創建界面 -->
        <div id="employeeCreateSection" class="interface-section hidden">
            <div class="interface-header">
                <h3><i class="fas fa-user-plus"></i> 員工創建</h3>
                <button class="back-btn" onclick="hideAllFeatures()">
                    <i class="fas fa-arrow-left"></i> 返回主選單
                </button>
            </div>
            
            <!-- 員工創建內容 -->
            <div id="employeeCreateContent" class="misc-section-content">
                <div class="form-group">
                    <label for="employeeCreateName">中文姓名：<span style="color: red;">*</span></label>
                    <input type="text" id="employeeCreateName" class="form-control" placeholder="例如：張三" required>
                </div>
                
                <div class="form-group">
                    <label for="employeeCreateEngName">英文姓名：<span style="color: red;">*</span></label>
                    <input type="text" id="employeeCreateEngName" class="form-control" placeholder="例如：John Smith" required>
                </div>
                
                <div class="form-group">
                    <label for="employeeCreatePhone">電話號碼：<span style="color: red;">*</span></label>
                    <input type="tel" id="employeeCreatePhone" class="form-control" placeholder="例如：1234567890" required>
                </div>
                
                <div class="form-group">
                    <label for="employeeCreateEmail">電子郵箱：</label>
                    <input type="email" id="employeeCreateEmail" class="form-control" placeholder="例如：example@email.com">
                </div>
                
                <div class="form-group">
                    <label for="employeeCreateClub">隸屬泳會：</label>
                    <div id="employeeCreateClubContainer" class="instructor-level-checkbox-container" style="max-height: 200px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 6px; padding: 12px; background: white;">
                        <!-- 選項將動態生成為複選框 -->
                    </div>
                    <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">
                        提示：點擊複選框可選擇多個隸屬泳會（手機和電腦都適用）
                    </small>
                </div>
                
                <div class="form-group">
                    <label for="employeeCreateWorkingType">類型：<span style="color: red;">*</span></label>
                    <select id="employeeCreateWorkingType" class="form-control" required>
                        <option value="full_time">全職</option>
                        <option value="part_time">兼職</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="employeeCreateInstructorLevel">導師級別：</label>
                    <div id="employeeCreateInstructorLevelContainer" class="instructor-level-checkbox-container" style="max-height: 200px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 6px; padding: 12px; background: white;">
                        <!-- 選項將動態生成為複選框 -->
                    </div>
                    <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">
                        提示：點擊複選框可選擇多個導師級別（手機和電腦都適用）
                    </small>
                </div>
                
                <div class="form-group">
                    <label for="employeeCreateType">職位：<span style="color: red;">*</span></label>
                    <select id="employeeCreateType" class="form-control" required>
                        <option value="coach">教練</option>
                        <option value="supervisor">主管</option>
                        <option value="admin">文書職員</option>
                        <option value="manager">管理員</option>
                    </select>
                </div>
                
                <div class="form-group" style="display: none;">
                    <label for="employeeCreatePassword">密碼：</label>
                    <input type="text" id="employeeCreatePassword" class="form-control" placeholder="系統自動生成" readonly>
                </div>
                
                <div class="settings-actions">
                    <button onclick="createEmployee()" class="btn-primary">
                        <i class="fas fa-user-plus"></i> 創建
                    </button>
                </div>
            </div>
                </div>
        
        <!-- 試堂創建界面 -->
        <div id="trialCreateSection" class="interface-section hidden">
            <div class="interface-header">
                <h3><i class="fas fa-swimming-pool"></i> 試堂創建</h3>
                <button class="back-btn" onclick="hideAllFeatures()">
                    <i class="fas fa-arrow-left"></i> 返回主選單
                </button>
            </div>
            
            <!-- 試堂創建內容 -->
            <div id="trialCreateContent" class="misc-section-content">
                <!-- 學員資料（支持多個） -->
                <h5 style="margin-bottom: 15px;">學員資料（可新增多個學員，共享同一個 TrailID）</h5>
                <div id="trialStudentsContainer" class="form-group">
                    <div class="trial-student-entry" style="display: grid; grid-template-columns: 2fr 1fr 1.5fr 1fr 1.5fr 1fr 1.5fr 1fr; gap: 10px; margin-bottom: 10px; align-items: end;">
                        <input type="text" class="form-control trial-student-name" placeholder="姓名 *" required>
                        <select class="form-control trial-student-gender" required>
                            <option value="">性別 *</option>
                            <option value="M">男</option>
                            <option value="F">女</option>
                        </select>
                        <input type="email" class="form-control trial-student-email" placeholder="郵箱">
                        <input type="tel" class="form-control trial-student-phone" placeholder="電話 *" required>
                        <input type="number" class="form-control trial-student-age" placeholder="年齡" min="1" max="120">
                        <select class="form-control trial-student-level">
                            <option value="">程度</option>
                            <option value="初学">初学</option>
                            <option value="中班">中班</option>
                            <option value="高班">高班</option>
                            <option value="游到一種泳式或以上">游到一種泳式或以上</option>
                            <option value="游到兩種式或以上">游到兩種式或以上</option>
                        </select>
                        <select class="form-control trial-student-howKnow">
                            <option value="">如何認識我們</option>
                            <option value="朋友介紹">朋友介紹</option>
                            <option value="Facebook">Facebook</option>
                            <option value="Instagram">Instagram</option>
                            <option value="Google">Google</option>
                            <option value="小紅書">小紅書</option>
                            <option value="電話查詢">電話查詢</option>
                            <option value="何巴巴游泳池">何巴巴游泳池</option>
                            <option value="Baby Tiger">Baby Tiger</option>
                        </select>
                        <button type="button" class="btn btn-danger remove-trial-student-btn" style="display: none;">刪除</button>
                    </div>
                </div>
                <button type="button" onclick="addNewTrialStudent()" class="btn btn-secondary" style="margin-bottom: 15px;">
                    <i class="fas fa-plus"></i> 新增學員
                </button>
                
                <!-- 共用資料（所有學員共享） -->
                <h5 style="margin-bottom: 15px; margin-top: 20px;">共用資料（所有學員共享）</h5>
                <div class="form-group">
                    <label for="trialClub">隸屬泳會：</label>
                    <div id="trialClubContainer" class="instructor-level-checkbox-container" style="max-height: 200px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 6px; padding: 12px; background: white;">
                        <!-- 選項將動態生成為複選框 -->
                    </div>
                    <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">
                        提示：點擊複選框可選擇多個隸屬泳會（手機和電腦都適用）
                    </small>
                </div>
                <div class="form-group">
                    <label for="trialLocation">上課地點：<span style="color: red;">*</span></label>
                    <div id="trialLocationContainer" class="instructor-level-checkbox-container" style="max-height: 200px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 6px; padding: 12px; background: white;">
                        <!-- 選項將動態生成為複選框 -->
                    </div>
                    <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">
                        提示：點擊複選框可選擇多個上課地點（手機和電腦都適用）
                    </small>
                </div>
                
                <div class="form-group">
                    <label>試堂時間：</label>
                    <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                        <label style="font-size: 12px; margin: 0;">開始：</label>
                        <select id="trialTimeStartHour" class="form-control" style="width: 70px; display: inline-block;">
                            <option value="">時</option>
                        </select>
                        <span>:</span>
                        <select id="trialTimeStartMin" class="form-control" style="width: 70px; display: inline-block;">
                            <option value="">分</option>
                        </select>
                        <label style="font-size: 12px; margin: 0; margin-left: 8px;">結束：</label>
                        <select id="trialTimeEndHour" class="form-control" style="width: 70px; display: inline-block;">
                            <option value="">時</option>
                        </select>
                        <span>:</span>
                        <select id="trialTimeEndMin" class="form-control" style="width: 70px; display: inline-block;">
                            <option value="">分</option>
                        </select>
                    </div>
                    <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">
                        提示：小時範圍 0-23，分鐘為 5 分鐘間隔（0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55）
                    </small>
                    <input type="hidden" id="trialTime" value="">
                </div>
                
                <div class="form-group">
                    <label for="trialDate">試堂日期：</label>
                    <input type="date" id="trialDate" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="trialPlatform">用什麼平臺瞭解我們：</label>
                    <select id="trialPlatform" class="form-control">
                        <option value="">請選擇</option>
                        <option value="Facebook">Facebook</option>
                        <option value="Instagram">Instagram</option>
                        <option value="托管">托管</option>
                        <option value="朋友">朋友</option>
                        <option value="Google">Google</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="trialNotes">備註：</label>
                    <textarea id="trialNotes" class="form-control" rows="3" placeholder="備註信息"></textarea>
                </div>
                
                <div class="settings-actions">
                    <button onclick="generateTrialInfo()" class="btn-primary">
                        <i class="fas fa-check-circle"></i> 生成試堂信息
                    </button>
                </div>
                
                <!-- 生成的賬單信息顯示區域 -->
                <div id="trialBillResult" class="hidden" style="margin-top: 20px; padding: 15px; background: #f3f4f6; border-radius: 8px;">
                    <h5 style="margin-bottom: 10px;">生成的試堂信息：</h5>
                    <div id="trialBillContent" style="background: white; padding: 15px; border-radius: 6px; white-space: pre-wrap; font-family: monospace; font-size: 13px; line-height: 1.6;"></div>
                    <button onclick="copyTrialBill()" class="btn-primary" style="margin-top: 10px;">
                        <i class="fas fa-copy"></i> 複製賬單信息
                    </button>
                </div>
                </div>
            </div>
            
        <!-- 賬單創建界面 -->
        <div id="billCreateSection" class="interface-section hidden">
            <div class="interface-header">
                <h3><i class="fas fa-file-invoice"></i> 賬單創建</h3>
                <button class="back-btn" onclick="hideAllFeatures()">
                    <i class="fas fa-arrow-left"></i> 返回主選單
                </button>
            </div>
            
            <!-- 賬單創建內容 -->
            <div id="billCreateContent" class="misc-section-content">
                <h5 style="margin-bottom: 15px;">報名類型</h5>
                <div class="form-group">
                    <label>
                        <input type="radio" name="registrationType" value="新生報名" checked> 新生報名
                    </label>
                    <label style="margin-left: 20px;">
                        <input type="radio" name="registrationType" value="學員續報"> 學員續報
                    </label>
                </div>
                
                <!-- ✅ 新生試堂資料已刪除（不再顯示試堂資料填寫） -->
                
                <!-- 學員資料 -->
                <h5 style="margin-bottom: 15px;">學員資料</h5>
                <div id="studentsContainer" class="form-group">
                    <div class="student-entry" style="display: grid; grid-template-columns: 1.5fr 2fr 1fr 1fr 2fr 2fr 2fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <!-- TrailID 欄位（新生報名模式下顯示） -->
                        <input type="text" class="form-control student-trail-id" placeholder="TrailID（選填）" data-trail-id-input style="display: block;">
                        <!-- 學生ID（電話）欄位（學員續報模式下顯示） -->
                        <input type="text" class="form-control student-id" placeholder="學生ID（選填）" style="display: none;" data-student-id-input>
                        <input type="text" class="form-control student-name" placeholder="學員姓名">
                        <input type="date" class="form-control student-birthday" placeholder="生日（選填）">
                        <input type="number" class="form-control student-age" placeholder="年齡" readonly>
                        <input type="tel" class="form-control student-phone" placeholder="電話（必填）">
                        <input type="email" class="form-control student-email" placeholder="郵箱（選填）">
                        <button type="button" class="btn btn-danger remove-student-btn" style="display: none;">刪除</button>
                    </div>
                </div>
                <button type="button" onclick="addNewStudent()" class="btn btn-secondary" style="margin-bottom: 15px;">
                    <i class="fas fa-plus"></i> 新增學員
                </button>
                
                <!-- 課程資料 -->
                <h5 style="margin-bottom: 15px;">課程資料</h5>
                <div class="form-group">
                    <label>隸屬泳會：</label>
                    <div id="billClubContainer" class="selector-container club-selector-container">
                        <!-- 選項將動態生成為按鈕選擇器 -->
                    </div>
                    <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">
                        提示：點擊按鈕可選擇多個隸屬泳會（手機和電腦都適用）
                    </small>
                </div>
                <div class="form-group">
                    <label>上課地點：<span style="color: red;">*</span></label>
                    <div id="locationContainer" class="selector-container location-selector-container">
                        <!-- 選項將動態生成為按鈕選擇器 -->
                    </div>
                    <input type="hidden" id="location" required>
                </div>
                
                <div class="form-group">
                    <label>課程類型：<span style="color: red;">*</span></label>
                    <div id="courseTypeContainer" class="selector-container course-type-selector-container">
                        <!-- 選項將動態生成為按鈕選擇器 -->
                    </div>
                    <input type="hidden" id="courseType" required>
                </div>
                
                <div class="form-group">
                    <label>課堂形式：<span style="color: red;">*</span></label>
                    <div id="classFormatContainer" class="selector-container class-format-selector-container">
                        <!-- 選項將根據課程類型動態生成 -->
                    </div>
                    <input type="hidden" id="classFormat" required>
                </div>
                
                <div class="form-group">
                    <label>導師級別：<span style="color: red;">*</span></label>
                    <div id="instructorTypeContainer" class="selector-container instructor-type-selector-container">
                        <!-- 選項將根據課程類型和課堂形式動態生成 -->
                    </div>
                    <input type="hidden" id="instructorType" required>
                </div>
                
                <div class="form-group">
                    <label>指定導師名稱（選填）：</label>
                    <input type="text" id="instructorName" class="form-control" list="instructorNameList" placeholder="輸入導師名稱搜索或從列表中選擇">
                    <datalist id="instructorNameList">
                        <!-- 選項將動態生成 -->
                    </datalist>
                </div>
                
                <div class="form-group">
                    <label>每堂收費：</label>
                    <input type="number" id="pricePerLesson" class="form-control" value="" min="1" readonly placeholder="選擇課程類型、課堂形式和導師級別後自動計算">
                </div>
                
                <!-- 學期堂數規劃 -->
                <div id="semesterPlanningSection" class="form-group" style="margin-top: 20px; padding: 15px; background-color: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb;">
                    <h5 style="margin-bottom: 15px;">學期堂數規劃</h5>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="font-size: 13px; font-weight: 500; color: #374151; margin-bottom: 4px; display: block;">每堂收費</label>
                            <div id="displayPricePerLesson" style="font-size: 18px; font-weight: 600; color: #667eea;">$0</div>
                        </div>
                        <div>
                            <label style="font-size: 13px; font-weight: 500; color: #374151; margin-bottom: 4px; display: block;">學員人數</label>
                            <div id="displayStudentCount" style="font-size: 18px; font-weight: 600; color: #667eea;">1人</div>
                        </div>
                        <div>
                            <label style="font-size: 13px; font-weight: 500; color: #374151; margin-bottom: 4px; display: block;">每期基本費用</label>
                            <div id="baseCostInfo" style="font-size: 12px; color: #6b7280; line-height: 1.6;">
                                7堂: $0 (無折扣)<br>
                                8堂: $0 → $0 (95折)<br>
                                12堂: $0 → $0 (9折)<br>
                                15堂: $0 → $0 (85折)
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; margin-bottom: 15px;">
                        <div class="period-planning">
                            <label class="block text-xs font-medium mb-0.5">A學期 (1-2月)</label>
                            <input type="number" class="period-lessons-input form-control" data-period="A學期 (1-2月)" min="0" value="0" style="padding: 6px 8px; font-size: 13px;">
                            <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">
                                <div class="period-cost">$0</div>
                                <div class="period-discount-info"></div>
                            </div>
                        </div>
                        <div class="period-planning">
                            <label class="block text-xs font-medium mb-0.5">B學期 (3-4月)</label>
                            <input type="number" class="period-lessons-input form-control" data-period="B學期 (3-4月)" min="0" value="0" style="padding: 6px 8px; font-size: 13px;">
                            <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">
                                <div class="period-cost">$0</div>
                                <div class="period-discount-info"></div>
                            </div>
                        </div>
                        <div class="period-planning">
                            <label class="block text-xs font-medium mb-0.5">C學期 (5-6月)</label>
                            <input type="number" class="period-lessons-input form-control" data-period="C學期 (5-6月)" min="0" value="0" style="padding: 6px 8px; font-size: 13px;">
                            <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">
                                <div class="period-cost">$0</div>
                                <div class="period-discount-info"></div>
                            </div>
                        </div>
                        <div class="period-planning">
                            <label class="block text-xs font-medium mb-0.5">D學期 (7-8月)</label>
                            <input type="number" class="period-lessons-input form-control" data-period="D學期 (7-8月)" min="0" value="0" style="padding: 6px 8px; font-size: 13px;">
                            <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">
                                <div class="period-cost">$0</div>
                                <div class="period-discount-info"></div>
                            </div>
                        </div>
                        <div class="period-planning">
                            <label class="block text-xs font-medium mb-0.5">E學期 (9-10月)</label>
                            <input type="number" class="period-lessons-input form-control" data-period="E學期 (9-10月)" min="0" value="0" style="padding: 6px 8px; font-size: 13px;">
                            <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">
                                <div class="period-cost">$0</div>
                                <div class="period-discount-info"></div>
                            </div>
                        </div>
                        <div class="period-planning">
                            <label class="block text-xs font-medium mb-0.5">F學期 (11-12月)</label>
                            <input type="number" class="period-lessons-input form-control" data-period="F學期 (11-12月)" min="0" value="0" style="padding: 6px 8px; font-size: 13px;">
                            <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">
                                <div class="period-cost">$0</div>
                                <div class="period-discount-info"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 餘下堂數及截至日期 -->
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label for="remainingLessons" style="font-size: 12px; font-weight: 500; color: #374151; margin-bottom: 4px; display: block;">餘下堂數 <small style="color: #9ca3af;">(選填)</small></label>
                                <input type="number" id="remainingLessons" min="0" class="form-control" placeholder="0" style="padding: 8px; font-size: 13px;">
                            </div>
                            <div>
                                <label style="font-size: 12px; font-weight: 500; color: #374151; margin-bottom: 4px; display: block;">截至日期 <small style="color: #9ca3af;">(選填)</small></label>
                                <!-- 預設日期顯示模式 -->
                                <div id="asOfDateDisplay" style="display: flex; gap: 8px;">
                                    <div style="flex: 1; background-color: #f3f4f6; border: 1px solid #d1d5db; border-radius: 6px; padding: 8px; font-size: 13px;">
                                        <span id="asOfDateText">未設定</span>
                                    </div>
                                    <button type="button" id="editAsOfDateBtn" class="btn btn-secondary" style="padding: 8px 12px; font-size: 12px;">
                                        設定
                                    </button>
                                </div>
                                
                                <!-- 日期選擇器模式 (初始隱藏) -->
                                <div id="asOfDateSelector" class="hidden" style="margin-top: 10px;">
                                    <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                                        <select id="asOfYear" class="form-control" style="flex: 1; padding: 6px; font-size: 13px;">
                                            <option value="2024">2024年</option>
                                            <option value="2025" selected>2025年</option>
                                            <option value="2026">2026年</option>
                                        </select>
                                        <select id="asOfMonth" class="form-control" style="flex: 1; padding: 6px; font-size: 13px;">
                                            <option value="1" selected>1月</option>
                                            <option value="2">2月</option>
                                            <option value="3">3月</option>
                                            <option value="4">4月</option>
                                            <option value="5">5月</option>
                                            <option value="6">6月</option>
                                            <option value="7">7月</option>
                                            <option value="8">8月</option>
                                            <option value="9">9月</option>
                                            <option value="10">10月</option>
                                            <option value="11">11月</option>
                                            <option value="12">12月</option>
                                        </select>
                                        <select id="asOfDay" class="form-control" style="flex: 1; padding: 6px; font-size: 13px;">
                                            <option value="1" selected>1日</option>
                                            <!-- 其他日期选项将通过JavaScript动态生成 -->
                                        </select>
                                    </div>
                                    
                                    <!-- 迷你日曆 -->
                                    <div id="asOfCalendarContainer" style="background-color: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; margin-bottom: 10px;">
                                        <!-- 月份導航 -->
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                            <button type="button" id="asOfPrevMonthBtn" class="btn btn-sm" style="padding: 4px 8px;">
                                                <i class="fas fa-chevron-left"></i>
                                            </button>
                                            <h6 id="asOfCalendarMonthYear" style="margin: 0; font-size: 14px; font-weight: 600;"></h6>
                                            <button type="button" id="asOfNextMonthBtn" class="btn btn-sm" style="padding: 4px 8px;">
                                                <i class="fas fa-chevron-right"></i>
                                            </button>
                                        </div>
                                        
                                        <!-- 星期標題 -->
                                        <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-bottom: 8px;">
                                            <div style="text-align: center; font-size: 11px; font-weight: 500; color: #6b7280; padding: 4px;">日</div>
                                            <div style="text-align: center; font-size: 11px; font-weight: 500; color: #6b7280; padding: 4px;">一</div>
                                            <div style="text-align: center; font-size: 11px; font-weight: 500; color: #6b7280; padding: 4px;">二</div>
                                            <div style="text-align: center; font-size: 11px; font-weight: 500; color: #6b7280; padding: 4px;">三</div>
                                            <div style="text-align: center; font-size: 11px; font-weight: 500; color: #6b7280; padding: 4px;">四</div>
                                            <div style="text-align: center; font-size: 11px; font-weight: 500; color: #6b7280; padding: 4px;">五</div>
                                            <div style="text-align: center; font-size: 11px; font-weight: 500; color: #6b7280; padding: 4px;">六</div>
                                        </div>
                                        
                                        <!-- 日期網格 -->
                                        <div id="asOfCalendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px;">
                                            <!-- 日期將在這裡動態生成 -->
                                        </div>
                                    </div>
                                    
                                    <!-- 確認按鈕 -->
                                    <div style="display: flex; gap: 8px;">
                                        <button type="button" id="confirmAsOfDateBtn" class="btn btn-primary" style="flex: 1; padding: 8px; font-size: 12px;">
                                            確認日期
                                        </button>
                                        <button type="button" id="cancelAsOfDateBtn" class="btn btn-secondary" style="padding: 8px 12px; font-size: 12px;">
                                            取消
                                        </button>
                                        <button type="button" id="clearAsOfDateBtn" class="btn btn-danger" style="padding: 8px 12px; font-size: 12px;">
                                            清除
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-size: 13px; color: #6b7280;">預計總堂數: <span id="plannedTotalLessons" style="font-weight: 600; color: #374151;">0堂</span></div>
                                <div style="font-size: 13px; color: #6b7280; margin-top: 4px;" id="consecutiveBonusInfo">尚未選擇學期</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 13px; color: #6b7280;">預計總費用</div>
                                <div id="plannedTotalCost" style="font-size: 20px; font-weight: bold; color: #667eea;">$0</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 上課時間和日期 -->
                <div class="form-group" style="margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h5 style="margin: 0;">上課時間及日期安排</h5>
                        <button type="button" onclick="addNewTimeSlot()" class="btn btn-secondary" style="font-size: 12px;">
                            <i class="fas fa-plus"></i> 新增時段
                        </button>
                    </div>
                    
                    <!-- 時段容器 -->
                    <div id="timeSlotsContainer" class="form-group">
                        <!-- 第一個時段 -->
                        <div class="time-slot" style="border: 1px solid #ddd; border-radius: 5px; padding: 15px; margin-bottom: 15px; background-color: #f9f9f9;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h6 style="margin: 0; font-weight: 600;">時段 1</h6>
                                <button type="button" class="remove-time-slot-btn btn btn-danger" style="font-size: 12px; padding: 5px 10px; opacity: 0.5; cursor: not-allowed;" disabled>
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            
                            <!-- 上課時間輸入 -->
                            <div class="form-group">
                                <label>上課時間：<span style="color: red;">*</span></label>
                                <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                                    <label style="font-size: 12px; margin: 0;">開始：</label>
                                    <select class="class-time-start-hour form-control" style="width: 70px; display: inline-block;">
                                        <option value="">時</option>
                                    </select>
                                    <span>:</span>
                                    <select class="class-time-start-min form-control" style="width: 70px; display: inline-block;">
                                        <option value="">分</option>
                                    </select>
                                    <label style="font-size: 12px; margin: 0; margin-left: 8px;">結束：</label>
                                    <select class="class-time-end-hour form-control" style="width: 70px; display: inline-block;">
                                        <option value="">時</option>
                                    </select>
                                    <span>:</span>
                                    <select class="class-time-end-min form-control" style="width: 70px; display: inline-block;">
                                        <option value="">分</option>
                                    </select>
                                </div>
                                <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">
                                    提示：小時範圍 0-23，分鐘為 5 分鐘間隔（0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55）
                                </small>
                                <input type="hidden" class="class-time" required>
                            </div>
                            
                            <!-- 每日堂數 -->
                            <div class="form-group">
                                <label>每日堂數：</label>
                                <select class="lessons-per-day form-control">
                                    <option value="1">1堂</option>
                                    <option value="1.5">1.5堂</option>
                                    <option value="2">2堂</option>
                                    <option value="2.5">2.5堂</option>
                                    <option value="3">3堂</option>
                                </select>
                            </div>
                            
                            <!-- 日曆和待約堂數 -->
                            <div class="slot-calendar-container" style="margin-top: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <label>選擇上課日期：</label>
                                    <button type="button" class="clear-slot-dates btn btn-sm" style="font-size: 11px; padding: 3px 8px;">
                                        清除此時段
                                    </button>
                                </div>
                                
                                <!-- 月份導航 -->
                                <div class="calendar-month-nav" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <button type="button" class="prev-month-btn btn btn-sm" style="padding: 5px 10px;">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <h6 class="current-month-year" style="margin: 0; font-weight: 600;"></h6>
                                    <button type="button" class="next-month-btn btn btn-sm" style="padding: 5px 10px;">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                                
                                <!-- 日曆網格 -->
                                <div class="calendar-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; background-color: #f0f0f0; padding: 4px; border-radius: 5px; margin-bottom: 10px;">
                                    <!-- 星期標題（可點擊） -->
                                    <div class="weekday-header text-center" data-weekday="0" data-chinese="星期日" style="font-weight: 600; padding: 6px; font-size: 12px; cursor: pointer; border-radius: 3px; transition: all 0.2s; user-select: none; min-height: 28px; display: flex; align-items: center; justify-content: center;">日</div>
                                    <div class="weekday-header text-center" data-weekday="1" data-chinese="星期一" style="font-weight: 600; padding: 6px; font-size: 12px; cursor: pointer; border-radius: 3px; transition: all 0.2s; user-select: none; min-height: 28px; display: flex; align-items: center; justify-content: center;">一</div>
                                    <div class="weekday-header text-center" data-weekday="2" data-chinese="星期二" style="font-weight: 600; padding: 6px; font-size: 12px; cursor: pointer; border-radius: 3px; transition: all 0.2s; user-select: none; min-height: 28px; display: flex; align-items: center; justify-content: center;">二</div>
                                    <div class="weekday-header text-center" data-weekday="3" data-chinese="星期三" style="font-weight: 600; padding: 6px; font-size: 12px; cursor: pointer; border-radius: 3px; transition: all 0.2s; user-select: none; min-height: 28px; display: flex; align-items: center; justify-content: center;">三</div>
                                    <div class="weekday-header text-center" data-weekday="4" data-chinese="星期四" style="font-weight: 600; padding: 6px; font-size: 12px; cursor: pointer; border-radius: 3px; transition: all 0.2s; user-select: none; min-height: 28px; display: flex; align-items: center; justify-content: center;">四</div>
                                    <div class="weekday-header text-center" data-weekday="5" data-chinese="星期五" style="font-weight: 600; padding: 6px; font-size: 12px; cursor: pointer; border-radius: 3px; transition: all 0.2s; user-select: none; min-height: 28px; display: flex; align-items: center; justify-content: center;">五</div>
                                    <div class="weekday-header text-center" data-weekday="6" data-chinese="星期六" style="font-weight: 600; padding: 6px; font-size: 12px; cursor: pointer; border-radius: 3px; transition: all 0.2s; user-select: none; min-height: 28px; display: flex; align-items: center; justify-content: center;">六</div>
                                    <!-- 日期將在這裡動態生成 -->
                                </div>
                                
                                <!-- 待約堂數控制 -->
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background-color: #f9f9f9; border-radius: 5px;">
                                    <span style="font-size: 13px; font-weight: 500;">本月待約堂數：</span>
                                    <div style="display: flex; gap: 5px; align-items: center;">
                                        <button type="button" class="decrease-pending-btn btn btn-sm" style="padding: 3px 8px;">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <input type="number" class="current-month-pending form-control" value="0" min="0" style="width: 50px; text-align: center; font-size: 12px;">
                                        <button type="button" class="increase-pending-btn btn btn-sm" style="padding: 3px 8px;">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 時段總結 -->
                            <div class="slot-summary" style="margin-top: 15px; padding: 10px; background-color: #e8f4f8; border-radius: 5px;">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div style="flex: 1;">
                                        <h6 style="font-size: 13px; font-weight: 600; margin-bottom: 5px;">此時段已選日期：</h6>
                                        <div class="slot-selected-dates" style="font-size: 12px; color: #666;">
                                            暫未選擇日期
                                        </div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 12px; color: #666;">時段堂數</div>
                                        <div class="slot-total-lessons" style="font-size: 20px; font-weight: bold; color: #007bff;">
                                            0
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 總計顯示 -->
                    <div id="allSlotsSummary" style="margin-top: 15px; padding: 15px; background-color: #d4edda; border-radius: 5px; border: 1px solid #28a745;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h6 style="font-size: 14px; font-weight: 600; color: #155724; margin-bottom: 5px;">所有時段總計：</h6>
                                <div id="allSlotsSelectedDates" style="font-size: 12px; color: #28a745;">
                                    暫未選擇日期
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 12px; color: #28a745;">總堂數</div>
                                <div id="totalAllLessons" style="font-size: 24px; font-weight: bold; color: #28a745;">
                                    0
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 總堂數顯示（隱藏） -->
                <div class="form-group" style="display: none;">
                    <label>總堂數：</label>
                    <input type="number" id="totalLessons" class="form-control" readonly placeholder="自動根據選擇的日期計算">
                </div>
                
                <div class="form-group">
                    <label>學生來源：</label>
                    <select id="studentSource" class="form-control" onchange="toggleReferrerNameSection()">
                        <option value="無">無</option>
                        <option value="朋友介紹">朋友介紹</option>
                        <option value="Facebook">Facebook</option>
                        <option value="Instagram">Instagram</option>
                        <option value="Google">Google</option>
                        <option value="小紅書">小紅書</option>
                        <option value="電話查詢">電話查詢</option>
                        <option value="何巴巴游泳池">何巴巴游泳池</option>
                        <option value="Baby Tiger">Baby Tiger</option>
                    </select>
                </div>
                
                <div id="referrerNameSection" class="form-group" style="display: none;">
                    <label>現有學員名字：</label>
                    <input type="text" id="referrerName" class="form-control" placeholder="例如：赵同学">
                </div>
                
                <!-- 折扣優惠 -->
                <h5 style="margin-bottom: 15px;">折扣優惠</h5>
                <div id="groupDiscountSection" class="form-group">
                    <label>新生首次報名同行優惠：</label>
                    <select id="groupDiscount" class="form-control">
                        <option value="1">單人報名 (無折扣)</option>
                        <option value="2">2人同行 (95折)</option>
                        <option value="3">3人同行 (9折)</option>
                        <option value="4">4人同行 (85折)</option>
                    </select>
                </div>
                
                <div id="referralDiscountSection" class="form-group" style="display: none;">
                    <label>介紹朋友人數 (每位減$200)：</label>
                    <select id="referralDiscount" class="form-control" onchange="updateReferralFields()">
                        <option value="0">無介紹朋友</option>
                        <option value="1">1位</option>
                        <option value="2">2位</option>
                        <option value="3">3位</option>
                        <option value="4">4位</option>
                        <option value="5">5位</option>
                        <option value="6">6位</option>
                        <option value="7">7位</option>
                        <option value="8">8位</option>
                        <option value="9">9位</option>
                        <option value="10">10位</option>
                    </select>
                </div>
                
                <div id="referralSection" class="form-group" style="display: none;">
                    <label>介紹朋友名單：</label>
                    <div id="referralContainer"></div>
                </div>
                
                <!-- 費用計算過程顯示 -->
                <div id="priceCalculationDisplay" class="form-group" style="display: none; background-color: #f8f9fa; padding: 15px; border-radius: 5px; border: 1px solid #dee2e6; margin-bottom: 15px;">
                    <label style="font-weight: bold; margin-bottom: 10px; color: #495057;">
                        <i class="fas fa-calculator"></i> 費用計算過程：
                    </label>
                    <div id="priceCalculationContent" style="font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.8; color: #212529;">
                        <!-- 計算過程將在這裡動態顯示 -->
                    </div>
                </div>
                
                <!-- 生成按鈕 -->
                <div class="settings-actions">
                    <button onclick="generateBillMessage()" class="btn-primary">
                        <i class="fas fa-file-invoice"></i> 生成繳費訊息
                    </button>
                    <button onclick="confirmRegistration()" class="btn-success" style="margin-left: 10px; display: none;" id="confirmBtn">
                        <i class="fas fa-check"></i> 確認報名
                    </button>
                </div>
                
                <!-- 生成的繳費訊息 -->
                <div id="billMessageOutput" class="form-group" style="display: none;">
                    <label>生成的繳費訊息：</label>
                    <textarea id="generatedBillMessage" class="form-control" rows="25" readonly style="font-family: monospace; font-size: 14px; line-height: 1.6;"></textarea>
                </div>
            </div>
        </div>
    </div>
    <div id="supervisorDataManagementSection" class="interface-section hidden">
        <div class="interface-header">
          <h3><i class="fas fa-database"></i> 資料管理</h3>
          <button class="back-btn" onclick="hideAllFeatures()"><i class="fas fa-arrow-left"></i> 返回主選單</button>
        </div>
        <div class="data-tabs">
          <button onclick="showDataTab('employee')">員工</button>
          <button onclick="showDataTab('formal')">正式會員</button>
          <button onclick="showDataTab('trial')">非正式會員</button>
          <button onclick="showDataTab('student-classes')">學生堂數</button>
          <button onclick="showDataTab('workhours')">工時記錄</button>
          <button onclick="showDataTab('roster')">教練更表</button>
        </div>
        <!-- ✅ 學生堂數操作按鈕（主管頁面） -->
        <div id="studentClassesActions" class="data-actions" style="display: none; padding: 10px; border-bottom: 1px solid #e5e7eb;">
          <button id="createPendingClassSupervisor" class="btn-primary" style="margin-right: 10px;">
            <i class="fas fa-plus-circle"></i> 待約創建
          </button>
        </div>
        <div id="supervisorDataSearchZone"></div>
        <div id="supervisorDataTableZone"></div>
            </div>
        </div>
    </div>
</div>

<!-- 管理員頁面 -->
<div id="adminSection" class="section">
    <nav class="top-nav">
        <div class="nav-left">
            <button class="sidebar-toggle-btn" onclick="toggleSidebar('admin')">
                <i class="fas fa-bars"></i>
            </button>
            <h2><i class="fas fa-user-shield"></i> 游泳系統 - 管理員</h2>
        </div>
        <div class="nav-right">
            <div class="user-info">
                <span id="userPhone"></span>
                <span id="userType"></span>
            </div>
            <button id="adminLogoutBtn" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i> 登出
            </button>
        </div>
    </nav>

    <div class="page-layout">
        <!-- 左側導航欄 -->
        <aside id="adminSidebar" class="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-user-shield"></i> 功能選單</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="sidebar-item" data-feature="data-management">
                    <i class="fas fa-database"></i>
                    <span>資料管理</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="admin-roster">
                    <i class="fas fa-calendar-alt"></i>
                    <span>管理員更表</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="admin-work-hours">
                    <i class="fas fa-clock"></i>
                    <span>工時管理</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="admin-personal-settings">
                    <i class="fas fa-user-cog"></i>
                    <span>個人設置</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="employee-create-admin">
                    <i class="fas fa-user-plus"></i>
                    <span>員工創建</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="trial-create-admin">
                    <i class="fas fa-swimming-pool"></i>
                    <span>試堂創建</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="bill-create-admin">
                    <i class="fas fa-file-invoice"></i>
                    <span>賬單創建</span>
                </a>
            </nav>
        </aside>

        <!-- 主內容區域 -->
        <div class="main-content-wrapper">
            <div class="main-content">

        <!-- 管理員更表界面 -->
        <div id="adminRosterInterface" class="interface-section hidden">
            <div class="interface-header">
                <h3 id="adminRosterSectionTitle"><i class="fas fa-calendar-alt"></i> 管理員更表</h3>
                <button class="back-btn" onclick="hideAllFeatures()">
                    <i class="fas fa-arrow-left"></i> 返回主選單
                </button>
            </div>
            
            <!-- 新的更表控制面板 -->
            <div class="roster-controls">
                <div class="control-group">
                    <label for="adminCoachSelect">選擇員工：</label>
                    <select id="adminCoachSelect" onchange="onChangeAdminCoach()">
                        <!-- 動態生成選項：自己 + 所有教練 -->
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="adminRosterMonth">月份選擇：</label>
                    <select id="adminRosterMonth" onchange="onAdminRosterMonthChange()">
                        <!-- 動態生成選項：當前月份前4個月到後6個月 -->
                    </select>
        </div>
            </div>
            
            <!-- 更表日曆容器 -->
            <div id="adminRosterCalendar" class="roster-calendar">
                <!-- 更表日曆將在這裡動態生成 -->
            </div>
        </div>

        <!-- 管理員工時管理界面 -->
        <div id="adminWorkHoursSection" class="interface-section hidden">
            <div class="interface-header">
                <h3><i class="fas fa-clock"></i> 管理員工時管理</h3>
                <button class="back-btn" onclick="hideAllFeatures()">
                    <i class="fas fa-arrow-left"></i> 返回主選單
                </button>
            </div>
            
            <!-- 工時管理控制面板 -->
            <div class="work-hours-controls">
                <div class="control-group">
                    <label for="workHoursEmployeeSelect">員工：</label>
                    <select id="workHoursEmployeeSelect" onchange="WorkHoursFunctions.onEmployeeChange()">
                        <!-- 動態生成選項 -->
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="workHoursYearSelect">年份：</label>
                    <select id="workHoursYearSelect" onchange="WorkHoursFunctions.onDateChange()">
                        <!-- 動態生成選項 -->
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="workHoursMonthSelect">月份：</label>
                    <select id="workHoursMonthSelect" onchange="WorkHoursFunctions.onDateChange()">
                        <!-- 動態生成選項 -->
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="adminWorkHoursLocationFilter">地點篩選：</label>
                    <div id="adminWorkHoursLocationFilter" class="filter-checkbox-container" style="max-height: 150px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 6px; padding: 8px; background: white; min-width: 150px;">
                        <!-- 選項將動態生成為複選框 -->
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="adminWorkHoursClubFilter">泳會篩選：</label>
                    <div id="adminWorkHoursClubFilter" class="filter-checkbox-container" style="max-height: 150px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 6px; padding: 8px; background: white; min-width: 150px;">
                        <!-- 選項將動態生成為複選框 -->
                    </div>
                </div>
                
                <div class="button-group">
                    <button onclick="WorkHoursFunctions.loadWorkHoursData()" class="btn-primary">
                        <i class="fas fa-download"></i> 載入工時
                    </button>
                    <button onclick="WorkHoursFunctions.exportAllWorkHours()" class="btn-secondary">
                        <i class="fas fa-file-excel"></i> 導出
                    </button>
                </div>
            </div>
            
            <!-- 工時表格容器 -->
            <div id="workHoursTableContainer" class="work-hours-table-container">
                <!-- 工時表格將在這裡動態生成 -->
            </div>
        </div>

        <!-- 管理員個人設置界面 -->
        <div id="adminPersonalSettingsSection" class="interface-section hidden">
            <div class="interface-header">
                <h3><i class="fas fa-user-cog"></i> 個人設置</h3>
                <button class="back-btn" onclick="hideAllFeatures()">
                    <i class="fas fa-arrow-left"></i> 返回主選單
                </button>
            </div>
            
            <div id="adminPersonalSettingsContainer" class="personal-settings-container">
                <div class="settings-section">
                    <h4>基本信息</h4>
                    <div class="form-group">
                        <label for="adminSettingsName">姓名：</label>
                        <input type="text" id="adminSettingsName" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="adminSettingsPhone">電話號碼：</label>
                        <input type="text" id="adminSettingsPhone" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="adminSettingsEmail">電子郵箱：</label>
                        <input type="email" id="adminSettingsEmail" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="adminSettingsPassword">登入密碼：</label>
                        <input type="password" id="adminSettingsPassword" class="form-control" placeholder="留空表示不修改">
                    </div>
                    <div class="form-group">
                        <label for="adminSettingsAddress">地址：</label>
                        <input type="text" id="adminSettingsAddress" class="form-control" placeholder="請輸入地址">
                    </div>
                    <div class="form-group">
                        <label for="adminSettingsIdCard">身份證號碼：</label>
                        <input type="text" id="adminSettingsIdCard" class="form-control" placeholder="請輸入身份證號碼">
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>銀行信息</h4>
                    <div class="form-group">
                        <label for="adminSettingsBankName">所屬銀行名稱：</label>
                        <input type="text" id="adminSettingsBankName" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="adminSettingsBankAccount">銀行賬戶：</label>
                        <input type="text" id="adminSettingsBankAccount" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="adminSettingsBankCard">銀行卡：</label>
                        <input type="text" id="adminSettingsBankCard" class="form-control" placeholder="請輸入銀行卡名稱">
                    </div>
                    <div class="form-group">
                        <label for="adminSettingsBankCardNumber">銀行卡號：</label>
                        <input type="text" id="adminSettingsBankCardNumber" class="form-control" placeholder="請輸入銀行卡號">
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button id="adminSaveSettingsBtn" class="btn-primary">
                        <i class="fas fa-save"></i> 保存設置
                    </button>
                </div>
            </div>
        </div>

        <!-- 員工創建界面（管理員） -->
        <div id="employeeCreateSectionAdmin" class="interface-section hidden">
            <div class="interface-header">
                <h3><i class="fas fa-user-plus"></i> 員工創建</h3>
                <button class="back-btn" onclick="hideAllFeatures()">
                    <i class="fas fa-arrow-left"></i> 返回主選單
                </button>
            </div>
            
            <!-- 員工創建內容 -->
            <div id="employeeCreateContentAdmin" class="misc-section-content">
                <div class="form-group">
                    <label for="employeeCreateNameAdmin">中文姓名：<span style="color: red;">*</span></label>
                    <input type="text" id="employeeCreateNameAdmin" class="form-control" placeholder="例如：張三" required>
                </div>
                
                <div class="form-group">
                    <label for="employeeCreateEngNameAdmin">英文姓名：<span style="color: red;">*</span></label>
                    <input type="text" id="employeeCreateEngNameAdmin" class="form-control" placeholder="例如：John Smith" required>
                </div>
                
                <div class="form-group">
                    <label for="employeeCreatePhoneAdmin">電話號碼：<span style="color: red;">*</span></label>
                    <input type="tel" id="employeeCreatePhoneAdmin" class="form-control" placeholder="例如：1234567890" required>
                </div>
                
                <div class="form-group">
                    <label for="employeeCreateEmailAdmin">電子郵箱：</label>
                    <input type="email" id="employeeCreateEmailAdmin" class="form-control" placeholder="例如：example@email.com">
                </div>
                
                <div class="form-group">
                    <label for="employeeCreateClubAdmin">隸屬泳會：</label>
                    <div id="employeeCreateClubContainerAdmin" class="instructor-level-checkbox-container" style="max-height: 200px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 6px; padding: 12px; background: white;">
                        <!-- 選項將動態生成為複選框 -->
                    </div>
                    <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">
                        提示：點擊複選框可選擇多個隸屬泳會（手機和電腦都適用）
                    </small>
                </div>
                
                <div class="form-group">
                    <label for="employeeCreateWorkingTypeAdmin">類型：<span style="color: red;">*</span></label>
                    <select id="employeeCreateWorkingTypeAdmin" class="form-control" required>
                        <option value="full_time">全職</option>
                        <option value="part_time">兼職</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="employeeCreateInstructorLevelAdmin">導師級別：</label>
                    <div id="employeeCreateInstructorLevelContainerAdmin" class="instructor-level-checkbox-container" style="max-height: 200px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 6px; padding: 12px; background: white;">
                        <!-- 選項將動態生成為複選框 -->
                    </div>
                    <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">
                        提示：點擊複選框可選擇多個導師級別（手機和電腦都適用）
                    </small>
                </div>
                
                <div class="form-group">
                    <label for="employeeCreateTypeAdmin">職位：<span style="color: red;">*</span></label>
                    <select id="employeeCreateTypeAdmin" class="form-control" required>
                        <option value="coach">教練</option>
                        <option value="supervisor">主管</option>
                        <option value="admin">文書職員</option>
                        <option value="manager">管理員</option>
                    </select>
                </div>
                
                <div class="form-group" style="display: none;">
                    <label for="employeeCreatePasswordAdmin">密碼：</label>
                    <input type="text" id="employeeCreatePasswordAdmin" class="form-control" placeholder="系統自動生成" readonly>
                </div>
                
                <div class="settings-actions">
                    <button onclick="createEmployee('Admin')" class="btn-primary">
                        <i class="fas fa-user-plus"></i> 創建
                    </button>
                </div>
                </div>
            </div>
            
        <!-- 試堂創建界面（管理員） -->
        <div id="trialCreateSectionAdmin" class="interface-section hidden">
            <div class="interface-header">
                <h3><i class="fas fa-swimming-pool"></i> 試堂創建</h3>
                <button class="back-btn" onclick="hideAllFeatures()">
                    <i class="fas fa-arrow-left"></i> 返回主選單
                </button>
            </div>
            
            <!-- 試堂創建內容 -->
            <div id="trialCreateContentAdmin" class="misc-section-content">
                <!-- 學員資料（支持多個） -->
                <h5 style="margin-bottom: 15px;">學員資料（可新增多個學員，共享同一個 TrailID）</h5>
                <div id="trialStudentsContainerAdmin" class="form-group">
                    <div class="trial-student-entry" style="display: grid; grid-template-columns: 2fr 1fr 1.5fr 1fr 1.5fr 1fr 1.5fr 1fr; gap: 10px; margin-bottom: 10px; align-items: end;">
                        <input type="text" class="form-control trial-student-name" placeholder="姓名 *" required>
                        <select class="form-control trial-student-gender" required>
                            <option value="">性別 *</option>
                        <option value="M">男</option>
                        <option value="F">女</option>
                    </select>
                        <input type="email" class="form-control trial-student-email" placeholder="郵箱">
                        <input type="tel" class="form-control trial-student-phone" placeholder="電話 *" required>
                        <input type="text" class="form-control trial-student-age-detail" placeholder="年齡（例如：5年3月）">
                        <select class="form-control trial-student-level">
                            <option value="">程度</option>
                            <option value="初学">初学</option>
                            <option value="中班">中班</option>
                            <option value="高班">高班</option>
                            <option value="游到一種泳式或以上">游到一種泳式或以上</option>
                            <option value="游到兩種式或以上">游到兩種式或以上</option>
                        </select>
                        <select class="form-control trial-student-howKnow">
                            <option value="">如何認識我們</option>
                            <option value="朋友介紹">朋友介紹</option>
                            <option value="Facebook">Facebook</option>
                            <option value="Instagram">Instagram</option>
                            <option value="Google">Google</option>
                            <option value="小紅書">小紅書</option>
                            <option value="電話查詢">電話查詢</option>
                            <option value="何巴巴游泳池">何巴巴游泳池</option>
                            <option value="Baby Tiger">Baby Tiger</option>
                        </select>
                        <button type="button" class="btn btn-danger remove-trial-student-btn" style="display: none;">刪除</button>
                </div>
                </div>
                <button type="button" onclick="addNewTrialStudent('Admin')" class="btn btn-secondary" style="margin-bottom: 15px;">
                    <i class="fas fa-plus"></i> 新增學員
                </button>
                
                <!-- 共用資料（所有學員共享） -->
                <h5 style="margin-bottom: 15px; margin-top: 20px;">共用資料（所有學員共享）</h5>
                <div class="form-group">
                    <label for="trialClubAdmin">隸屬泳會：</label>
                    <div id="trialClubContainerAdmin" class="instructor-level-checkbox-container" style="max-height: 200px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 6px; padding: 12px; background: white;">
                        <!-- 選項將動態生成為複選框 -->
                    </div>
                    <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">
                        提示：點擊複選框可選擇多個隸屬泳會（手機和電腦都適用）
                    </small>
                </div>
                <div class="form-group">
                    <label for="trialLocationAdmin">上課地點：<span style="color: red;">*</span></label>
                    <div id="trialLocationContainerAdmin" class="instructor-level-checkbox-container" style="max-height: 200px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 6px; padding: 12px; background: white;">
                        <!-- 選項將動態生成為複選框 -->
                    </div>
                    <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">
                        提示：點擊複選框可選擇多個上課地點（手機和電腦都適用）
                    </small>
                </div>
                
                <div class="form-group">
                    <label>試堂時間：</label>
                    <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                        <label style="font-size: 12px; margin: 0;">開始：</label>
                        <select id="trialTimeStartHourAdmin" class="form-control" style="width: 70px; display: inline-block;">
                            <option value="">時</option>
                        </select>
                        <span>:</span>
                        <select id="trialTimeStartMinAdmin" class="form-control" style="width: 70px; display: inline-block;">
                            <option value="">分</option>
                        </select>
                        <label style="font-size: 12px; margin: 0; margin-left: 8px;">結束：</label>
                        <select id="trialTimeEndHourAdmin" class="form-control" style="width: 70px; display: inline-block;">
                            <option value="">時</option>
                        </select>
                        <span>:</span>
                        <select id="trialTimeEndMinAdmin" class="form-control" style="width: 70px; display: inline-block;">
                            <option value="">分</option>
                        </select>
                    </div>
                    <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">
                        提示：小時範圍 0-23，分鐘為 5 分鐘間隔（0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55）
                    </small>
                    <input type="hidden" id="trialTimeAdmin" value="">
                </div>
                
                <div class="form-group">
                    <label for="trialDateAdmin">試堂日期：</label>
                    <input type="date" id="trialDateAdmin" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="trialPlatformAdmin">用什麼平臺瞭解我們：</label>
                    <select id="trialPlatformAdmin" class="form-control">
                        <option value="">請選擇</option>
                        <option value="Facebook">Facebook</option>
                        <option value="Instagram">Instagram</option>
                        <option value="托管">托管</option>
                        <option value="朋友">朋友</option>
                        <option value="Google">Google</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="trialNotesAdmin">備註：</label>
                    <textarea id="trialNotesAdmin" class="form-control" rows="3" placeholder="備註信息"></textarea>
                </div>
                
                <div class="settings-actions">
                    <button onclick="generateTrialInfo('Admin')" class="btn-primary">
                        <i class="fas fa-check-circle"></i> 生成試堂信息
                    </button>
                </div>
                
                <!-- 生成的賬單信息顯示區域 -->
                <div id="trialBillResultAdmin" class="hidden" style="margin-top: 20px; padding: 15px; background: #f3f4f6; border-radius: 8px;">
                    <h5 style="margin-bottom: 10px;">生成的試堂信息：</h5>
                    <div id="trialBillContentAdmin" style="background: white; padding: 15px; border-radius: 6px; white-space: pre-wrap; font-family: monospace; font-size: 13px; line-height: 1.6;"></div>
                    <button onclick="copyTrialBill('Admin')" class="btn-primary" style="margin-top: 10px;">
                        <i class="fas fa-copy"></i> 複製賬單信息
                    </button>
                </div>
                </div>
            </div>
            
        <!-- 賬單創建界面（管理員） -->
        <div id="billCreateSectionAdmin" class="interface-section hidden">
            <div class="interface-header">
                <h3><i class="fas fa-file-invoice"></i> 賬單創建</h3>
                <button class="back-btn" onclick="hideAllFeatures()">
                    <i class="fas fa-arrow-left"></i> 返回主選單
                </button>
            </div>
            
            <!-- 賬單創建內容 -->
            <div id="billCreateContentAdmin" class="misc-section-content">
                <h5 style="margin-bottom: 15px;">報名類型</h5>
                <div class="form-group">
                    <label>
                        <input type="radio" name="registrationTypeAdmin" value="新生報名" checked> 新生報名
                    </label>
                    <label style="margin-left: 20px;">
                        <input type="radio" name="registrationTypeAdmin" value="學員續報"> 學員續報
                    </label>
            </div>
                
                <!-- ✅ 新生試堂資料已刪除（不再顯示試堂資料填寫） -->
                
                <!-- 學員資料 -->
                <h5 style="margin-bottom: 15px;">學員資料</h5>
                <div id="studentsContainerAdmin" class="form-group">
                    <div class="student-entry" style="display: grid; grid-template-columns: 1.5fr 2fr 1fr 1fr 2fr 2fr 2fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <!-- TrailID 欄位（新生報名模式下顯示） -->
                        <input type="text" class="form-control student-trail-id" placeholder="TrailID（選填）" data-trail-id-input style="display: block;">
                        <!-- 學生ID（電話）欄位（學員續報模式下顯示） -->
                        <input type="text" class="form-control student-id" placeholder="學生ID（選填）" style="display: none;" data-student-id-input>
                        <input type="text" class="form-control student-name" placeholder="學員姓名">
                        <input type="date" class="form-control student-birthday" placeholder="生日（選填）">
                        <input type="number" class="form-control student-age" placeholder="年齡" readonly>
                        <input type="tel" class="form-control student-phone" placeholder="電話（必填）">
                        <input type="email" class="form-control student-email" placeholder="郵箱（選填）">
                        <button type="button" class="btn btn-danger remove-student-btn" style="display: none;">刪除</button>
                    </div>
                </div>
                <button type="button" onclick="addNewStudent('Admin')" class="btn btn-secondary" style="margin-bottom: 15px;">
                    <i class="fas fa-plus"></i> 新增學員
                </button>
                
                <!-- 課程資料 -->
                <h5 style="margin-bottom: 15px;">課程資料</h5>
                <div class="form-group">
                    <label>隸屬泳會：</label>
                    <div id="billClubContainerAdmin" class="selector-container club-selector-container">
                        <!-- 選項將動態生成為按鈕選擇器 -->
                    </div>
                    <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">
                        提示：點擊按鈕可選擇多個隸屬泳會（手機和電腦都適用）
                    </small>
                </div>
                <div class="form-group">
                    <label>上課地點：<span style="color: red;">*</span></label>
                    <div id="locationContainerAdmin" class="selector-container location-selector-container">
                        <!-- 選項將動態生成為按鈕選擇器 -->
                    </div>
                    <input type="hidden" id="locationAdmin" required>
                </div>
                
                <div class="form-group">
                    <label>課程類型：<span style="color: red;">*</span></label>
                    <div id="courseTypeContainerAdmin" class="selector-container course-type-selector-container">
                        <!-- 選項將動態生成為按鈕選擇器 -->
                    </div>
                    <input type="hidden" id="courseTypeAdmin" required>
                </div>
                
                <div class="form-group">
                    <label>課堂形式：<span style="color: red;">*</span></label>
                    <div id="classFormatContainerAdmin" class="selector-container class-format-selector-container">
                        <!-- 選項將根據課程類型動態生成 -->
                    </div>
                    <input type="hidden" id="classFormatAdmin" required>
                </div>
                
                <div class="form-group">
                    <label>導師級別：<span style="color: red;">*</span></label>
                    <div id="instructorTypeContainerAdmin" class="selector-container instructor-type-selector-container">
                        <!-- 選項將根據課程類型和課堂形式動態生成 -->
                    </div>
                    <input type="hidden" id="instructorTypeAdmin" required>
                </div>
                
                <div class="form-group">
                    <label>指定導師名稱（選填）：</label>
                    <input type="text" id="instructorNameAdmin" class="form-control" list="instructorNameListAdmin" placeholder="輸入導師名稱搜索或從列表中選擇">
                    <datalist id="instructorNameListAdmin">
                        <!-- 選項將動態生成 -->
                    </datalist>
                </div>
                
                <div class="form-group">
                    <label>每堂收費：</label>
                    <input type="number" id="pricePerLessonAdmin" class="form-control" value="" min="1" readonly placeholder="選擇課程類型、課堂形式和導師級別後自動計算">
                </div>
                
                <!-- 學期堂數規劃 -->
                <div id="semesterPlanningSectionAdmin" class="form-group" style="margin-top: 20px; padding: 15px; background-color: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb;">
                    <h5 style="margin-bottom: 15px;">學期堂數規劃</h5>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="font-size: 13px; font-weight: 500; color: #374151; margin-bottom: 4px; display: block;">每堂收費</label>
                            <div id="displayPricePerLessonAdmin" style="font-size: 18px; font-weight: 600; color: #667eea;">$0</div>
                        </div>
                        <div>
                            <label style="font-size: 13px; font-weight: 500; color: #374151; margin-bottom: 4px; display: block;">學員人數</label>
                            <div id="displayStudentCountAdmin" style="font-size: 18px; font-weight: 600; color: #667eea;">1人</div>
                        </div>
                        <div>
                            <label style="font-size: 13px; font-weight: 500; color: #374151; margin-bottom: 4px; display: block;">每期基本費用</label>
                            <div id="baseCostInfoAdmin" style="font-size: 12px; color: #6b7280; line-height: 1.6;">
                                7堂: $0 (無折扣)<br>
                                8堂: $0 → $0 (95折)<br>
                                12堂: $0 → $0 (9折)<br>
                                15堂: $0 → $0 (85折)
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; margin-bottom: 15px;">
                        <div class="period-planning">
                            <label class="block text-xs font-medium mb-0.5">A學期 (1-2月)</label>
                            <input type="number" class="period-lessons-input form-control" data-period="A學期 (1-2月)" min="0" value="0" style="padding: 6px 8px; font-size: 13px;">
                            <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">
                                <div class="period-cost">$0</div>
                                <div class="period-discount-info"></div>
                            </div>
                        </div>
                        <div class="period-planning">
                            <label class="block text-xs font-medium mb-0.5">B學期 (3-4月)</label>
                            <input type="number" class="period-lessons-input form-control" data-period="B學期 (3-4月)" min="0" value="0" style="padding: 6px 8px; font-size: 13px;">
                            <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">
                                <div class="period-cost">$0</div>
                                <div class="period-discount-info"></div>
                            </div>
                        </div>
                        <div class="period-planning">
                            <label class="block text-xs font-medium mb-0.5">C學期 (5-6月)</label>
                            <input type="number" class="period-lessons-input form-control" data-period="C學期 (5-6月)" min="0" value="0" style="padding: 6px 8px; font-size: 13px;">
                            <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">
                                <div class="period-cost">$0</div>
                                <div class="period-discount-info"></div>
                            </div>
                        </div>
                        <div class="period-planning">
                            <label class="block text-xs font-medium mb-0.5">D學期 (7-8月)</label>
                            <input type="number" class="period-lessons-input form-control" data-period="D學期 (7-8月)" min="0" value="0" style="padding: 6px 8px; font-size: 13px;">
                            <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">
                                <div class="period-cost">$0</div>
                                <div class="period-discount-info"></div>
                            </div>
                        </div>
                        <div class="period-planning">
                            <label class="block text-xs font-medium mb-0.5">E學期 (9-10月)</label>
                            <input type="number" class="period-lessons-input form-control" data-period="E學期 (9-10月)" min="0" value="0" style="padding: 6px 8px; font-size: 13px;">
                            <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">
                                <div class="period-cost">$0</div>
                                <div class="period-discount-info"></div>
                            </div>
                        </div>
                        <div class="period-planning">
                            <label class="block text-xs font-medium mb-0.5">F學期 (11-12月)</label>
                            <input type="number" class="period-lessons-input form-control" data-period="F學期 (11-12月)" min="0" value="0" style="padding: 6px 8px; font-size: 13px;">
                            <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">
                                <div class="period-cost">$0</div>
                                <div class="period-discount-info"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 餘下堂數及截至日期 -->
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label for="remainingLessonsAdmin" style="font-size: 12px; font-weight: 500; color: #374151; margin-bottom: 4px; display: block;">餘下堂數 <small style="color: #9ca3af;">(選填)</small></label>
                                <input type="number" id="remainingLessonsAdmin" min="0" class="form-control" placeholder="0" style="padding: 8px; font-size: 13px;">
                            </div>
                            <div>
                                <label style="font-size: 12px; font-weight: 500; color: #374151; margin-bottom: 4px; display: block;">截至日期 <small style="color: #9ca3af;">(選填)</small></label>
                                <!-- 預設日期顯示模式 -->
                                <div id="asOfDateDisplayAdmin" style="display: flex; gap: 8px;">
                                    <div style="flex: 1; background-color: #f3f4f6; border: 1px solid #d1d5db; border-radius: 6px; padding: 8px; font-size: 13px;">
                                        <span id="asOfDateTextAdmin">未設定</span>
                                    </div>
                                    <button type="button" id="editAsOfDateBtnAdmin" class="btn btn-secondary" style="padding: 8px 12px; font-size: 12px;">
                                        設定
                                    </button>
                                </div>
                                
                                <!-- 日期選擇器模式 (初始隱藏) -->
                                <div id="asOfDateSelectorAdmin" class="hidden" style="margin-top: 10px;">
                                    <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                                        <select id="asOfYearAdmin" class="form-control" style="flex: 1; padding: 6px; font-size: 13px;">
                                            <option value="2024">2024年</option>
                                            <option value="2025" selected>2025年</option>
                                            <option value="2026">2026年</option>
                                        </select>
                                        <select id="asOfMonthAdmin" class="form-control" style="flex: 1; padding: 6px; font-size: 13px;">
                                            <option value="1" selected>1月</option>
                                            <option value="2">2月</option>
                                            <option value="3">3月</option>
                                            <option value="4">4月</option>
                                            <option value="5">5月</option>
                                            <option value="6">6月</option>
                                            <option value="7">7月</option>
                                            <option value="8">8月</option>
                                            <option value="9">9月</option>
                                            <option value="10">10月</option>
                                            <option value="11">11月</option>
                                            <option value="12">12月</option>
                                        </select>
                                        <select id="asOfDayAdmin" class="form-control" style="flex: 1; padding: 6px; font-size: 13px;">
                                            <option value="1" selected>1日</option>
                                            <!-- 其他日期选项将通过JavaScript动态生成 -->
                                        </select>
                                    </div>
                                    
                                    <!-- 迷你日曆 -->
                                    <div id="asOfCalendarContainerAdmin" style="background-color: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; margin-bottom: 10px;">
                                        <!-- 月份導航 -->
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                            <button type="button" id="asOfPrevMonthBtnAdmin" class="btn btn-sm" style="padding: 4px 8px;">
                                                <i class="fas fa-chevron-left"></i>
                                            </button>
                                            <h6 id="asOfCalendarMonthYearAdmin" style="margin: 0; font-size: 14px; font-weight: 600;"></h6>
                                            <button type="button" id="asOfNextMonthBtnAdmin" class="btn btn-sm" style="padding: 4px 8px;">
                                                <i class="fas fa-chevron-right"></i>
                                            </button>
                                        </div>
                                        
                                        <!-- 星期標題 -->
                                        <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-bottom: 8px;">
                                            <div style="text-align: center; font-size: 11px; font-weight: 500; color: #6b7280; padding: 4px;">日</div>
                                            <div style="text-align: center; font-size: 11px; font-weight: 500; color: #6b7280; padding: 4px;">一</div>
                                            <div style="text-align: center; font-size: 11px; font-weight: 500; color: #6b7280; padding: 4px;">二</div>
                                            <div style="text-align: center; font-size: 11px; font-weight: 500; color: #6b7280; padding: 4px;">三</div>
                                            <div style="text-align: center; font-size: 11px; font-weight: 500; color: #6b7280; padding: 4px;">四</div>
                                            <div style="text-align: center; font-size: 11px; font-weight: 500; color: #6b7280; padding: 4px;">五</div>
                                            <div style="text-align: center; font-size: 11px; font-weight: 500; color: #6b7280; padding: 4px;">六</div>
                                        </div>
                                        
                                        <!-- 日期網格 -->
                                        <div id="asOfCalendarGridAdmin" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px;">
                                            <!-- 日期將在這裡動態生成 -->
                                        </div>
                                    </div>
                                    
                                    <!-- 確認按鈕 -->
                                    <div style="display: flex; gap: 8px;">
                                        <button type="button" id="confirmAsOfDateBtnAdmin" class="btn btn-primary" style="flex: 1; padding: 8px; font-size: 12px;">
                                            確認日期
                                        </button>
                                        <button type="button" id="cancelAsOfDateBtnAdmin" class="btn btn-secondary" style="padding: 8px 12px; font-size: 12px;">
                                            取消
                                        </button>
                                        <button type="button" id="clearAsOfDateBtnAdmin" class="btn btn-danger" style="padding: 8px 12px; font-size: 12px;">
                                            清除
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-size: 13px; color: #6b7280;">預計總堂數: <span id="plannedTotalLessonsAdmin" style="font-weight: 600; color: #374151;">0堂</span></div>
                                <div style="font-size: 13px; color: #6b7280; margin-top: 4px;" id="consecutiveBonusInfoAdmin">尚未選擇學期</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 13px; color: #6b7280;">預計總費用</div>
                                <div id="plannedTotalCostAdmin" style="font-size: 20px; font-weight: bold; color: #667eea;">$0</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 上課時間和日期 -->
                <div class="form-group" style="margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h5 style="margin: 0;">上課時間及日期安排</h5>
                        <button type="button" onclick="addNewTimeSlot('Admin')" class="btn btn-secondary" style="font-size: 12px;">
                            <i class="fas fa-plus"></i> 新增時段
                        </button>
                    </div>
                    
                    <!-- 時段容器 -->
                    <div id="timeSlotsContainerAdmin" class="form-group">
                        <!-- 第一個時段 -->
                        <div class="time-slot" style="border: 1px solid #ddd; border-radius: 5px; padding: 15px; margin-bottom: 15px; background-color: #f9f9f9;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h6 style="margin: 0; font-weight: 600;">時段 1</h6>
                                <button type="button" class="remove-time-slot-btn btn btn-danger" style="font-size: 12px; padding: 5px 10px; opacity: 0.5; cursor: not-allowed;" disabled>
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            
                            <!-- 上課時間輸入 -->
                            <div class="form-group">
                                <label>上課時間：<span style="color: red;">*</span></label>
                                <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                                    <label style="font-size: 12px; margin: 0;">開始：</label>
                                    <select class="class-time-start-hour form-control" style="width: 70px; display: inline-block;">
                                        <option value="">時</option>
                                    </select>
                                    <span>:</span>
                                    <select class="class-time-start-min form-control" style="width: 70px; display: inline-block;">
                                        <option value="">分</option>
                                    </select>
                                    <label style="font-size: 12px; margin: 0; margin-left: 8px;">結束：</label>
                                    <select class="class-time-end-hour form-control" style="width: 70px; display: inline-block;">
                                        <option value="">時</option>
                                    </select>
                                    <span>:</span>
                                    <select class="class-time-end-min form-control" style="width: 70px; display: inline-block;">
                                        <option value="">分</option>
                                    </select>
                                </div>
                                <small style="color: #6b7280; font-size: 12px; margin-top: 4px; display: block;">
                                    提示：小時範圍 0-23，分鐘為 5 分鐘間隔（0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55）
                                </small>
                                <input type="hidden" class="class-time" required>
                            </div>
                            
                            <!-- 每日堂數 -->
                            <div class="form-group">
                                <label>每日堂數：</label>
                                <select class="lessons-per-day form-control">
                                    <option value="1">1堂</option>
                                    <option value="1.5">1.5堂</option>
                                    <option value="2">2堂</option>
                                    <option value="2.5">2.5堂</option>
                                    <option value="3">3堂</option>
                                </select>
                            </div>
                            
                            <!-- 日曆和待約堂數 -->
                            <div class="slot-calendar-container" style="margin-top: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <label>選擇上課日期：</label>
                                    <button type="button" class="clear-slot-dates btn btn-sm" style="font-size: 11px; padding: 3px 8px;">
                                        清除此時段
                                    </button>
                                </div>
                                
                                <!-- 月份導航 -->
                                <div class="calendar-month-nav" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <button type="button" class="prev-month-btn btn btn-sm" style="padding: 5px 10px;">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <h6 class="current-month-year" style="margin: 0; font-weight: 600;"></h6>
                                    <button type="button" class="next-month-btn btn btn-sm" style="padding: 5px 10px;">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                                
                                <!-- 日曆網格 -->
                                <div class="calendar-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; background-color: #f0f0f0; padding: 4px; border-radius: 5px; margin-bottom: 10px;">
                                    <!-- 星期標題（可點擊） -->
                                    <div class="weekday-header text-center" data-weekday="0" data-chinese="星期日" style="font-weight: 600; padding: 6px; font-size: 12px; cursor: pointer; border-radius: 3px; transition: all 0.2s; user-select: none; min-height: 28px; display: flex; align-items: center; justify-content: center;">日</div>
                                    <div class="weekday-header text-center" data-weekday="1" data-chinese="星期一" style="font-weight: 600; padding: 6px; font-size: 12px; cursor: pointer; border-radius: 3px; transition: all 0.2s; user-select: none; min-height: 28px; display: flex; align-items: center; justify-content: center;">一</div>
                                    <div class="weekday-header text-center" data-weekday="2" data-chinese="星期二" style="font-weight: 600; padding: 6px; font-size: 12px; cursor: pointer; border-radius: 3px; transition: all 0.2s; user-select: none; min-height: 28px; display: flex; align-items: center; justify-content: center;">二</div>
                                    <div class="weekday-header text-center" data-weekday="3" data-chinese="星期三" style="font-weight: 600; padding: 6px; font-size: 12px; cursor: pointer; border-radius: 3px; transition: all 0.2s; user-select: none; min-height: 28px; display: flex; align-items: center; justify-content: center;">三</div>
                                    <div class="weekday-header text-center" data-weekday="4" data-chinese="星期四" style="font-weight: 600; padding: 6px; font-size: 12px; cursor: pointer; border-radius: 3px; transition: all 0.2s; user-select: none; min-height: 28px; display: flex; align-items: center; justify-content: center;">四</div>
                                    <div class="weekday-header text-center" data-weekday="5" data-chinese="星期五" style="font-weight: 600; padding: 6px; font-size: 12px; cursor: pointer; border-radius: 3px; transition: all 0.2s; user-select: none; min-height: 28px; display: flex; align-items: center; justify-content: center;">五</div>
                                    <div class="weekday-header text-center" data-weekday="6" data-chinese="星期六" style="font-weight: 600; padding: 6px; font-size: 12px; cursor: pointer; border-radius: 3px; transition: all 0.2s; user-select: none; min-height: 28px; display: flex; align-items: center; justify-content: center;">六</div>
                                    <!-- 日期將在這裡動態生成 -->
                                </div>
                                
                                <!-- 待約堂數控制 -->
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background-color: #f9f9f9; border-radius: 5px;">
                                    <span style="font-size: 13px; font-weight: 500;">本月待約堂數：</span>
                                    <div style="display: flex; gap: 5px; align-items: center;">
                                        <button type="button" class="decrease-pending-btn btn btn-sm" style="padding: 3px 8px;">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <input type="number" class="current-month-pending form-control" value="0" min="0" style="width: 50px; text-align: center; font-size: 12px;">
                                        <button type="button" class="increase-pending-btn btn btn-sm" style="padding: 3px 8px;">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 時段總結 -->
                            <div class="slot-summary" style="margin-top: 15px; padding: 10px; background-color: #e8f4f8; border-radius: 5px;">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div style="flex: 1;">
                                        <h6 style="font-size: 13px; font-weight: 600; margin-bottom: 5px;">此時段已選日期：</h6>
                                        <div class="slot-selected-dates" style="font-size: 12px; color: #666;">
                                            暫未選擇日期
                                        </div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 12px; color: #666;">時段堂數</div>
                                        <div class="slot-total-lessons" style="font-size: 20px; font-weight: bold; color: #007bff;">
                                            0
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 總計顯示 -->
                    <div id="allSlotsSummaryAdmin" style="margin-top: 15px; padding: 15px; background-color: #d4edda; border-radius: 5px; border: 1px solid #28a745;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h6 style="font-size: 14px; font-weight: 600; color: #155724; margin-bottom: 5px;">所有時段總計：</h6>
                                <div id="allSlotsSelectedDatesAdmin" style="font-size: 12px; color: #28a745;">
                                    暫未選擇日期
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 12px; color: #28a745;">總堂數</div>
                                <div id="totalAllLessonsAdmin" style="font-size: 24px; font-weight: bold; color: #28a745;">
                                    0
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 總堂數顯示（隱藏） -->
                <div class="form-group" style="display: none;">
                    <label>總堂數：</label>
                    <input type="number" id="totalLessonsAdmin" class="form-control" readonly placeholder="自動根據選擇的日期計算">
                </div>
                
                <div class="form-group">
                    <label>學生來源：</label>
                    <select id="studentSourceAdmin" class="form-control" onchange="toggleReferrerNameSection('Admin')">
                        <option value="無">無</option>
                        <option value="朋友介紹">朋友介紹</option>
                        <option value="Facebook">Facebook</option>
                        <option value="Instagram">Instagram</option>
                        <option value="Google">Google</option>
                        <option value="小紅書">小紅書</option>
                        <option value="電話查詢">電話查詢</option>
                        <option value="何巴巴游泳池">何巴巴游泳池</option>
                        <option value="Baby Tiger">Baby Tiger</option>
                    </select>
                </div>
                
                <div id="referrerNameSectionAdmin" class="form-group" style="display: none;">
                    <label>現有學員名字：</label>
                    <input type="text" id="referrerNameAdmin" class="form-control" placeholder="例如：赵同学">
                </div>
                
                <!-- 折扣優惠 -->
                <h5 style="margin-bottom: 15px;">折扣優惠</h5>
                <div id="groupDiscountSectionAdmin" class="form-group">
                    <label>新生首次報名同行優惠：</label>
                    <select id="groupDiscountAdmin" class="form-control">
                        <option value="1">單人報名 (無折扣)</option>
                        <option value="2">2人同行 (95折)</option>
                        <option value="3">3人同行 (9折)</option>
                        <option value="4">4人同行 (85折)</option>
                    </select>
                </div>
                
                <div id="referralDiscountSectionAdmin" class="form-group" style="display: none;">
                    <label>介紹朋友人數 (每位減$200)：</label>
                    <select id="referralDiscountAdmin" class="form-control" onchange="updateReferralFields('Admin')">
                        <option value="0">無介紹朋友</option>
                        <option value="1">1位</option>
                        <option value="2">2位</option>
                        <option value="3">3位</option>
                        <option value="4">4位</option>
                        <option value="5">5位</option>
                        <option value="6">6位</option>
                        <option value="7">7位</option>
                        <option value="8">8位</option>
                        <option value="9">9位</option>
                        <option value="10">10位</option>
                    </select>
                </div>
                
                <div id="referralSectionAdmin" class="form-group" style="display: none;">
                    <label>介紹朋友名單：</label>
                    <div id="referralContainerAdmin"></div>
                </div>
                
                <!-- 費用計算過程顯示（管理員頁面） -->
                <div id="priceCalculationDisplayAdmin" class="form-group" style="display: none; background-color: #f8f9fa; padding: 15px; border-radius: 5px; border: 1px solid #dee2e6; margin-bottom: 15px;">
                    <label style="font-weight: bold; margin-bottom: 10px; color: #495057;">
                        <i class="fas fa-calculator"></i> 費用計算過程：
                    </label>
                    <div id="priceCalculationContentAdmin" style="font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.8; color: #212529;">
                        <!-- 計算過程將在這裡動態顯示 -->
                    </div>
                </div>
                
                <!-- 生成按鈕 -->
                <div class="settings-actions">
                    <button onclick="generateBillMessage('Admin')" class="btn-primary">
                        <i class="fas fa-file-invoice"></i> 生成繳費訊息
                    </button>
                    <button onclick="confirmRegistration('Admin')" class="btn-success" style="margin-left: 10px; display: none;" id="confirmBtnAdmin">
                        <i class="fas fa-check"></i> 確認報名
                    </button>
                </div>
                
                <!-- 生成的繳費訊息 -->
                <div id="billMessageOutputAdmin" class="form-group" style="display: none;">
                    <label>生成的繳費訊息：</label>
                    <textarea id="generatedBillMessageAdmin" class="form-control" rows="25" readonly style="font-family: monospace; font-size: 14px; line-height: 1.6;"></textarea>
                </div>
            </div>
        </div>
        
        <!-- 管理員資料管理界面 -->
        <div id="adminDataManagementSection" class="interface-section hidden">
        <div class="interface-header">
          <h3><i class="fas fa-database"></i> 資料管理</h3>
          <button class="back-btn" onclick="hideAllFeatures()"><i class="fas fa-arrow-left"></i> 返回主選單</button>
        </div>
        <div class="data-tabs">
          <button onclick="showDataTab('employee')">員工</button>
          <button onclick="showDataTab('formal')">正式會員</button>
          <button onclick="showDataTab('trial')">非正式會員</button>
          <button onclick="showDataTab('student-classes')">學生堂數</button>
        </div>
        <!-- ✅ 學生堂數操作按鈕（管理員頁面） -->
        <div id="studentClassesActionsAdmin" class="data-actions" style="display: none; padding: 10px; border-bottom: 1px solid #e5e7eb;">
          <button id="createPendingClassAdmin" class="btn-primary" style="margin-right: 10px;">
            <i class="fas fa-plus-circle"></i> 待約創建
          </button>
        </div>
            <div id="adminDataSearchZone"></div>
            <div id="adminDataTableZone"></div>
            </div>
        </div>
    </div>
</div>

<!-- ✅ 待補創建模態窗口 -->
<div id="createPendingClassModal" class="modal" style="display: none;">
  <div class="modal-content" style="max-width: 500px;">
    <div class="modal-header">
      <h3><i class="fas fa-plus-circle"></i> 待約創建</h3>
      <button class="modal-close" onclick="closeCreatePendingClassModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>學生ID <span style="color: red;">*</span></label>
        <input type="text" id="pendingClassStudentId" class="form-control" placeholder="輸入學生ID" />
        <div id="pendingClassNoSlotsWarning" style="display: none; color: #dc3545; font-size: 12px; margin-top: 4px;">
          <i class="fas fa-exclamation-triangle"></i> 沒有多餘的堂數可以創建
        </div>
      </div>
      <div class="form-group">
        <label>姓名</label>
        <input type="text" id="pendingClassName" class="form-control" readonly />
      </div>
      <div class="form-group">
        <label>電話 <span style="color: red;">*</span></label>
        <input type="text" id="pendingClassPhone" class="form-control" placeholder="輸入電話號碼" />
      </div>
      <div id="pendingClassStudentSelector" class="form-group" style="display: none;">
        <label>學生ID <span style="color: red;">*</span></label>
        <select id="pendingClassStudentIdSelect" class="form-control">
          <option value="">請選擇學生ID</option>
        </select>
      </div>
      <div class="form-group">
        <label>日期 <span style="color: red;">*</span></label>
        <input type="date" id="pendingClassDate" class="form-control" />
      </div>
      <div class="form-group">
        <label>課程類型 <span style="color: red;">*</span></label>
        <select id="pendingClassCourseType" class="form-control">
          <option value="">請選擇課程類型</option>
        </select>
      </div>
      <div class="form-group">
        <label>時間 <span style="color: red;">*</span> (格式: hhmm-hhmm)</label>
        <input type="text" id="pendingClassTime" class="form-control" placeholder="例如: 0900-1000" pattern="[0-9]{4}-[0-9]{4}" />
      </div>
      <div class="form-group">
        <label>地點 <span style="color: red;">*</span></label>
        <select id="pendingClassLocation" class="form-control">
          <option value="">請選擇地點</option>
        </select>
      </div>
    </div>
    <div class="modal-footer">
      <button onclick="closeCreatePendingClassModal()" class="btn-secondary">取消</button>
      <button onclick="confirmCreatePendingClass()" class="btn-primary">創建</button>
    </div>
  </div>
</div>

<!-- 學生頁面 -->
<div id="studentSection" class="section">
    <nav class="top-nav">
        <div class="nav-left">
            <button class="sidebar-toggle-btn" onclick="toggleSidebar('student')">
                <i class="fas fa-bars"></i>
            </button>
            <h2><i class="fas fa-user-graduate"></i> 游泳系統 - 學生</h2>
        </div>
        <div class="nav-right">
            <div class="user-info">
                <span id="userPhone"></span>
                <span id="userType"></span>
            </div>
            <button id="studentLogoutBtn" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i> 登出
            </button>
        </div>
    </nav>

    <div class="page-layout">
        <!-- 左側導航欄 -->
        <aside id="studentSidebar" class="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-user-graduate"></i> 功能選單</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="sidebar-item" data-feature="student-schedule">
                    <i class="fas fa-calendar-check"></i>
                    <span>我的課程</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="student-attendance">
                    <i class="fas fa-clipboard-list"></i>
                    <span>出席記錄</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="student-progress">
                    <i class="fas fa-chart-line"></i>
                    <span>學習進度</span>
                </a>
                <a href="#" class="sidebar-item" data-feature="student-profile">
                    <i class="fas fa-user"></i>
                    <span>個人資料</span>
                </a>
            </nav>
        </aside>

        <!-- 主內容區域 -->
        <div class="main-content-wrapper">
            <div class="main-content">
        <!-- 學生功能選單 -->
        <div class="feature-grid">
            <div class="feature-card" data-feature="student-schedule">
                <div class="feature-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <h3>我的課程</h3>
                <p>查看我的課程安排</p>
            </div>
            
            <div class="feature-card" data-feature="student-attendance">
                <div class="feature-icon">
                    <i class="fas fa-clipboard-list"></i>
                </div>
                <h3>出席記錄</h3>
                <p>查看我的出席記錄</p>
            </div>
            
            <div class="feature-card" data-feature="student-progress">
                <div class="feature-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h3>學習進度</h3>
                <p>查看學習進度報告</p>
            </div>
            
            <div class="feature-card" data-feature="student-profile">
                <div class="feature-icon">
                    <i class="fas fa-user"></i>
                </div>
                <h3>個人資料</h3>
                <p>管理個人資料</p>
            </div>
        </div>

        <!-- 學生功能內容區域 -->
        <div id="studentContent" class="student-content">
            <div class="student-placeholder">
                <h3>學生功能開發中...</h3>
                <p>此功能正在開發中，敬請期待。</p>
            </div>
        </div>
    </div>
</div>

    <!-- 載入中覆蓋層 -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>載入中...</p>
        </div>
    </div>

    <!-- JavaScript 文件 -->
    <!-- 0. 性能優化工具（最先加載） -->
    <script src="performance-optimizer.js?v=1"></script>
    
    <!-- 1. 關鍵基礎模組（同步加載，阻塞渲染） -->
    <script src="security-manager.js?v=20250115"></script>
    <script src="database-connector.js?v=30"></script>
    
    <!-- 2. 主應用程序 (必須先加載，定義全局變量) -->
    <script src="main-app.js?v=53"></script>
    
    <!-- 3. 非關鍵模組（異步加載，不阻塞渲染） -->
    <script src="utils.js?v=20250124" defer></script>
    <script src="virtual-scroll.js?v=20250124" defer></script>
    <script src="employee-create-functions.js?v=20250210" defer></script>
    <script src="bill-create-functions-time-slots.js?v=20250202" defer></script>
    <script src="trial-create-functions.js?v=20250221" defer></script>
    <script src="work-hours-functions.js?v=20250115" defer></script>
    <script src="attendance-board.js?v=20250209" defer></script>
    <script src="coach-functions.js?v=20250221" defer></script>
    <script src="supervisor-functions.js?v=20250218" defer></script>
    <script src="admin-functions.js?v=20250115" defer></script>
    <script src="personal-settings.js?v=20250221" defer></script>
    
    <!-- 4. 性能優化：預加載關鍵資源 -->
    <script>
        // 預加載常用數據（在後台進行，不阻塞頁面）
        if ('requestIdleCallback' in window) {
            requestIdleCallback(() => {
                const db = window.App?.getDatabaseConnector();
                if (db) {
                    // 預加載地點和泳會數據
                    Promise.all([
                        fetch(`${db.baseUrl}/locations`, { headers: db.getStandardHeaders() }).catch(() => null),
                        fetch(`${db.baseUrl}/clubs`, { headers: db.getStandardHeaders() }).catch(() => null)
                    ]).then(() => console.log('✅ 預加載完成'));
                }
            });
        }
    </script>
</body>
</html>

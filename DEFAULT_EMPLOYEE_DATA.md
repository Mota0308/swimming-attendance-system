# 默认员工资料说明

## 一、员工列表获取逻辑 (`getEditableEmployees`)

根据不同的用户类型，系统会返回不同的员工列表：

### 1. 主管/管理员页面 (`supervisor` 或 `manager`)
**员工列表组成：**
- ✅ 当前登录的主管/管理员自己
- ✅ 所有文書職員 (`type='admin'`)
- ✅ 所有教練 (`type='coach'`)
- ❌ 不包括其他主管 (`type='supervisor'`)
- ❌ 不包括其他管理员 (`type='manager'`)

**数据来源：**
- 自己：从 `currentUser` 获取
- 文書職員：从 `/admins` API 获取，过滤 `type='admin'`
- 教練：从 `/coaches` API 获取

**员工对象结构：**
```javascript
{
    phone: string,           // 电话号码（唯一标识）
    name: string,            // 姓名
    type: string,            // 角色类型：'supervisor'/'manager'/'admin'/'coach'
    employeeId: string,      // 员工ID（格式：首字母+4位数字，如 'C0001', 'A0001'）
    bankAccount: string,     // 银行账户（可选）
    bankName: string        // 银行名称（可选）
}
```

### 2. 文書職員页面 (`admin`)
**员工列表组成：**
- ✅ 当前登录的文書職員自己
- ✅ 所有教練 (`type='coach'`)
- ❌ 不包括其他文書職員
- ❌ 不包括主管和管理员

**数据来源：**
- 自己：从 `currentUser` 获取
- 教練：从 `/coaches` API 获取

### 3. 教練页面 (`coach`)
**员工列表组成：**
- ✅ 只显示当前登录的教練自己

**数据来源：**
- 自己：从 `currentUser` 获取

---

## 二、默认员工选择逻辑 (`populateEmployeeSelect`)

### 1. 管理员页面 (`prefix='workHours'`)
**默认选择：**
- ✅ 优先选择管理员自己（如果自己在员工列表中）
- ✅ 如果找不到自己，则选择第一个员工

**显示格式：**
- 管理员自己：`姓名 (type) - 自己`
- 其他员工：`姓名 (type)`

### 2. 主管页面 (`prefix='supervisorWorkHours'`)
**默认选择：**
- ✅ 选择第一个员工（`employees[0]`）

**显示格式：**
- 所有员工：`姓名 (type)`

### 3. 教練页面 (`prefix='coachWorkHours'`)
**默认选择：**
- ✅ 没有员工选择器，直接使用当前登录用户

---

## 三、员工数据字段说明

### 必需字段
- `phone`: 电话号码（唯一标识符）
- `name`: 姓名
- `type`: 角色类型
  - `'supervisor'`: 主管
  - `'manager'`: 管理员
  - `'admin'`: 文書職員
  - `'coach'`: 教練

### 可选字段
- `employeeId`: 员工ID（格式：首字母+4位数字）
  - 教練：`C0001`, `C0002`, ...
  - 文書職員：`A0001`, `A0002`, ...
  - 主管：`S0001`, `S0002`, ...
  - 管理员：`M0001`, `M0002`, ...
- `bankAccount`: 银行账户
- `bankName`: 银行名称

### 字段获取优先级
1. 如果 `employeeId` 存在，优先使用 `employeeId`
2. 如果 `employeeId` 不存在，使用 `phone` 作为后备

---

## 四、后端 API 端点

### 1. 获取教練列表
- **端点：** `GET /coaches`
- **返回：** `{ success: true, coaches: [...] }`
- **查询条件：** `{ type: 'coach' }`

### 2. 获取所有员工（包括所有类型）
- **端点：** `GET /admins`
- **返回：** `{ success: true, admins: [...] }`
- **查询条件：** `{}` (所有记录)
- **注意：** 需要在前端过滤出 `type='admin'` 的文書職員

---

## 五、默认员工选择示例

### 场景1：主管登录
```javascript
// 员工列表顺序：
// 1. 主管自己
// 2. 文書職員1
// 3. 文書職員2
// 4. 教練1
// 5. 教練2
// ...
// 默认选择：主管自己（第一个）
```

### 场景2：管理员登录
```javascript
// 员工列表顺序：
// 1. 管理员自己
// 2. 文書職員1
// 3. 文書職員2
// 4. 教練1
// 5. 教練2
// ...
// 默认选择：管理员自己（如果存在）
```

### 场景3：文書職員登录
```javascript
// 员工列表顺序：
// 1. 文書職員自己
// 2. 教練1
// 3. 教練2
// ...
// 默认选择：文書職員自己（第一个）
```

### 场景4：教練登录
```javascript
// 员工列表：
// 1. 教練自己
// 默认选择：教練自己（唯一选项）
```

---

## 六、注意事项

1. **employeeId 确保机制：**
   - 如果员工对象缺少 `employeeId`，系统会使用 `phone` 作为后备
   - 系统会尝试从 `getEditableEmployees` 获取完整的员工对象（包含 `employeeId`）

2. **数据一致性：**
   - 所有员工对象都通过 `ensureEmployeeId` 函数确保包含 `employeeId`
   - 如果后端没有返回 `employeeId`，前端会使用 `phone` 作为后备

3. **默认选择逻辑：**
   - 管理员页面：优先选择自己
   - 主管页面：选择第一个员工（通常是主管自己）
   - 教練页面：没有选择器，直接使用当前用户

4. **自动加载数据：**
   - 初始化完成后，系统会自动加载默认选中员工的工时数据
   - 无需手动点击"載入工時"按钮


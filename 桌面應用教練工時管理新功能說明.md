# 桌面應用教練工時管理新功能說明

## 功能概述

根據您的需求，我已經成功為桌面應用的教練工時管理頁面添加了地點和泳會的下拉選項清單功能。

### 新增功能
- **地點選擇**：在"載入工時"按鈕左邊添加了"選擇地點"下拉清單
- **泳會選擇**：在"載入工時"按鈕左邊添加了"選擇泳會"下拉清單
- **智能篩選**：支持按教練、月份、地點、泳會四個維度篩選工時記錄
- **數據關聯**：工時記錄與地點和泳會信息關聯存儲

## 操作流程

### 新的操作邏輯
1. **選擇教練名稱** → 從教練下拉清單中選擇
2. **選擇月份** → 從月份下拉清單中選擇
3. **選擇地點** → 從地點下拉清單中選擇
4. **選擇泳會** → 從泳會下拉清單中選擇
5. **載入工時** → 點擊"載入工時"按鈕，彈出對應的工時記錄表

### 界面布局
```
[選擇教練] [選擇月份] [選擇地點] [選擇泳會] [載入工時] [保存工時] [導出報表]
```

## 技術實現

### 1. 前端界面修改
- **index.html**：在工時記錄區域添加了地點和泳會的下拉選項清單
- **renderer.js**：
  - 添加了 `initializeLocationSelector()` 函數初始化地點選擇器
  - 添加了 `initializeClubSelector()` 函數初始化泳會選擇器
  - 修改了 `loadCoachWorkHours()` 函數支持地點和泳會參數
  - 修改了 `saveCoachWorkHours()` 函數支持地點和泳會保存
  - 更新了所有change事件監聽器，確保所有選擇都完成後才載入工時

### 2. 後端數據處理
- **main.js**：
  - 修改了 `fetch-coach-work-hours` 處理程序，支持地點和泳會篩選
  - 修改了 `save-coach-work-hours` 處理程序，支持地點和泳會保存

### 3. 數據庫查詢
- 支持按以下條件篩選工時記錄：
  - `phone`：教練電話
  - `date`：日期範圍（月份）
  - `location`：地點
  - `club`：泳會

## 預設選項

### 地點列表
- 維多利亞公園游泳池
- 荔枝角公園游泳池
- 觀塘游泳池
- 深水埗公園游泳池
- 九龍公園游泳池

### 泳會列表
- 維多利亞泳會
- 荔枝角泳會
- 觀塘泳會
- 深水埗泳會
- 九龍泳會

## 數據庫結構

### Coach_work_hours 集合
```javascript
{
  _id: ObjectId,
  phone: String,          // 教練電話
  date: String,           // 日期 (YYYY-MM-DD)
  hours: Number,          // 工時
  location: String,       // 地點（新增）
  club: String,           // 泳會（新增）
  createdAt: Date,        // 創建時間
  updatedAt: Date         // 更新時間
}
```

## 查詢邏輯

### 載入工時查詢條件
```javascript
{
  phone: "教練電話",
  date: { $gte: "2025-08-01", $lte: "2025-08-31" },
  location: "選擇的地點",
  club: "選擇的泳會"
}
```

### 保存工時更新
```javascript
{
  $set: {
    phone: "教練電話",
    date: "日期",
    hours: 工時數,
    location: "地點",
    club: "泳會",
    updatedAt: new Date()
  }
}
```

## 驗證機制

### 前端驗證
- 檢查是否已選擇教練
- 檢查是否已選擇月份
- 檢查是否已選擇地點
- 檢查是否已選擇泳會
- 只有所有選擇都完成後才能載入工時

### 自動觸發
- 當所有選擇都完成後，自動觸發載入工時功能
- 支持任意順序選擇，只要四個條件都滿足就會自動載入

## 測試驗證

### 測試腳本
- `test-desktop-coach-features.js`：測試新功能
- 驗證了查詢、統計、數據庫結構等所有功能

### 測試結果
- ✅ 支持按教練、月份、地點、泳會篩選工時記錄
- ✅ 數據庫結構包含 location 和 club 字段
- ✅ 查詢功能正常工作
- ✅ 統計功能正常工作

## 使用示例

### 場景1：查看特定教練在特定地點的工時
1. 選擇教練：張教練
2. 選擇月份：2025年8月
3. 選擇地點：維多利亞公園游泳池
4. 選擇泳會：維多利亞泳會
5. 點擊"載入工時"
6. 顯示該教練在該地點該泳會的8月份工時記錄

### 場景2：比較不同地點的工時
1. 選擇教練：李教練
2. 選擇月份：2025年8月
3. 選擇地點：荔枝角公園游泳池
4. 選擇泳會：荔枝角泳會
5. 點擊"載入工時"
6. 顯示該教練在荔枝角公園的工時記錄

## 注意事項

1. **數據完整性**：所有工時記錄都必須包含地點和泳會信息
2. **向後兼容**：現有數據已自動添加空的地點和泳會字段
3. **用戶體驗**：必須完成所有選擇才能載入工時，避免數據不完整
4. **錯誤處理**：包含完整的錯誤提示和驗證機制

## 總結

新功能已完全按照您的需求實現：
- ✅ 在"載入工時"按鈕左邊添加了地點和泳會下拉選項清單
- ✅ 實現了完整的操作流程：教練 → 月份 → 地點 → 泳會 → 載入工時
- ✅ 數據庫查詢與 `Coach_work_hours` 中的 `location` 和 `club` 字段對應
- ✅ 支持精確篩選，彈出對應的工時記錄表
- ✅ 所有功能都經過測試驗證，運行正常

現在您可以按照新的流程使用教練工時管理功能，實現更精確的工時記錄查詢和管理。 
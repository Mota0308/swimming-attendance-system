<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>課程編排系統 - 遞進篩選演示</title>
    <link rel="stylesheet" href="scheduler-light-theme.css">
    <link rel="stylesheet" href="attendance-board-light.css">
    <style>
        .demo-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .filter-demo {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .filter-step {
            background: white;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .step-number {
            background: #007bff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }
        .console-output {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }
        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .test-btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,123,255,0.4);
        }
        .test-btn:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="demo-info">
            <h1>🎯 課程編排系統 - 遞進篩選演示</h1>
            <p>這個演示展示了新的遞進篩選邏輯，篩選條件會層層縮小範圍，而不是並列執行。</p>
        </div>

        <div class="filter-demo">
            <h2>🔄 遞進篩選邏輯說明</h2>
            
            <div class="filter-step">
                <span class="step-number">1</span>
                <strong>數據預處理</strong>：標準化時間格式和星期信息
            </div>
            
            <div class="filter-step">
                <span class="step-number">2</span>
                <strong>地點篩選</strong>：如果選擇地點，先按地點縮小範圍
            </div>
            
            <div class="filter-step">
                <span class="step-number">3</span>
                <strong>星期篩選</strong>：在已縮小的範圍內，再按星期進一步縮小
            </div>
            
            <div class="filter-step">
                <span class="step-number">4</span>
                <strong>智能回退</strong>：如果沒有結果，智能回退到上一層篩選
            </div>
            
            <div class="filter-step">
                <span class="step-number">5</span>
                <strong>數據去重</strong>：去除重複的學生記錄
            </div>
        </div>

        <div class="test-buttons">
            <button class="test-btn" onclick="testProgressiveFilter()">🧪 測試遞進篩選</button>
            <button class="test-btn" onclick="testLocationFilter()">📍 測試地點篩選</button>
            <button class="test-btn" onclick="testDayFilter()">📅 測試星期篩選</button>
            <button class="test-btn" onclick="testCombinedFilter()">🔗 測試組合篩選</button>
            <button class="test-btn" onclick="clearConsole()">🗑️ 清空控制台</button>
        </div>

        <div class="console-output" id="consoleOutput">
            <div>控制台輸出將顯示在這裡...</div>
        </div>

        <div class="scheduler-container" id="schedulerContainer">
            <h2>課程編排系統</h2>
            <div class="scheduler-controls">
                <div class="control-group">
                    <label for="schDate">日期：</label>
                    <input type="date" id="schDate" onchange="updateSchedule()">
                </div>
                <div class="control-group">
                    <label for="schLoc">地點：</label>
                    <select id="schLoc" onchange="updateSchedule()">
                        <option value="">請選擇地點</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="schDay">星期：</label>
                    <select id="schDay" onchange="updateSchedule()">
                        <option value="">請選擇星期</option>
                        <option value="一">星期一</option>
                        <option value="二">星期二</option>
                        <option value="三">星期三</option>
                        <option value="四">星期四</option>
                        <option value="五">星期五</option>
                        <option value="六">星期六</option>
                        <option value="日">星期日</option>
                    </select>
                </div>
                <button class="btn-primary" onclick="updateSchedule()">更新課程表</button>
            </div>
            <div class="time-slots" id="timeSlots"></div>
        </div>

        <div class="attendance-board-container" id="attendanceBoardContainer">
            <h2>出席記錄板</h2>
            <div class="board-controls">
                <div class="control-group">
                    <label for="attendanceLocation">地點：</label>
                    <select id="attendanceLocation" onchange="updateAttendanceBoard()">
                        <option value="">請選擇地點</option>
                    </select>
                </div>
                <button class="btn-primary" onclick="updateAttendanceBoard()">更新出席記錄</button>
            </div>
            <div class="attendance-board" id="attendanceBoard"></div>
        </div>
    </div>

    <script>
        // 模擬 databaseConnector
        window.databaseConnector = {
            apiConfig: {
                baseURL: 'https://swimming-system-web-production.up.railway.app'
            },
            getStandardHeaders: () => ({
                'Content-Type': 'application/json',
                'Authorization': 'Bearer demo-token'
            }),
            updateStudentLesson: async (data) => {
                console.log('更新學生課程:', data);
                return { success: true };
            }
        };

        // 模擬 toast 函數
        window.toast = (message) => {
            console.log('Toast:', message);
            const output = document.getElementById('consoleOutput');
            const div = document.createElement('div');
            div.textContent = `[Toast] ${message}`;
            div.style.color = '#ffd700';
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        };

        // 測試函數
        function testProgressiveFilter() {
            console.log('🧪 開始測試遞進篩選邏輯...');
            logToConsole('🧪 開始測試遞進篩選邏輯...');
            
            // 模擬數據
            const mockStudents = [
                { name: '張小明', location: '荔枝角公園', day: '一', time: '14:00-15:00', phone: '12345678' },
                { name: '李小華', location: '荔枝角公園', day: '一', time: '15:00-16:00', phone: '23456789' },
                { name: '王小美', location: '荔枝角公園', day: '二', time: '14:00-15:00', phone: '34567890' },
                { name: '陳小強', location: '維多利亞公園', day: '一', time: '14:00-15:00', phone: '45678901' },
                { name: '劉小芳', location: '維多利亞公園', day: '二', time: '15:00-16:00', phone: '56789012' }
            ];
            
            logToConsole(`📊 模擬數據：${mockStudents.length}名學生`);
            logToConsole(`📍 地點：荔枝角公園(${mockStudents.filter(s => s.location === '荔枝角公園').length}人), 維多利亞公園(${mockStudents.filter(s => s.location === '維多利亞公園').length}人)`);
            logToConsole(`📅 星期：星期一(${mockStudents.filter(s => s.day === '一').length}人), 星期二(${mockStudents.filter(s => s.day === '二').length}人)`);
        }

        function testLocationFilter() {
            logToConsole('📍 測試地點篩選：選擇荔枝角公園');
            logToConsole('   原始數據：5名學生');
            logToConsole('   地點篩選後：3名學生 (縮小範圍)');
            logToConsole('   最終結果：3名學生');
        }

        function testDayFilter() {
            logToConsole('📅 測試星期篩選：選擇星期一');
            logToConsole('   原始數據：5名學生');
            logToConsole('   星期篩選後：3名學生 (縮小範圍)');
            logToConsole('   最終結果：3名學生');
        }

        function testCombinedFilter() {
            logToConsole('🔗 測試組合篩選：荔枝角公園 + 星期一');
            logToConsole('   原始數據：5名學生');
            logToConsole('   地點篩選：5 → 3 (縮小範圍)');
            logToConsole('   星期篩選：3 → 2 (進一步縮小範圍)');
            logToConsole('   最終結果：2名學生');
        }

        function clearConsole() {
            const output = document.getElementById('consoleOutput');
            output.innerHTML = '<div>控制台已清空...</div>';
        }

        function logToConsole(message) {
            const output = document.getElementById('consoleOutput');
            const div = document.createElement('div');
            div.textContent = message;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎯 遞進篩選演示頁面已加載');
            logToConsole('🎯 遞進篩選演示頁面已加載');
            
            // 設置默認日期為今天
            const today = new Date();
            document.getElementById('schDate').value = today.toISOString().split('T')[0];
            
            // 自動推導星期
            const dayMap = ['日', '一', '二', '三', '四', '五', '六'];
            const dayOfWeek = dayMap[today.getDay()];
            document.getElementById('schDay').value = dayOfWeek;
        });
    </script>
</body>
</html> 
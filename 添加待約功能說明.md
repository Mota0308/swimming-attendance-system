# ➕ 添加待約功能說明

## 功能概述

在系統配置頁面新增了"添加待約"功能，允許用戶為有待約記錄的學生創建新的上課記錄。創建新記錄後，系統會自動將原始學生的"wait"數量減去1。

## 功能特點

### 1. 🎯 智能學生選擇
- 自動檢查雲端資料庫中所有有"wait"內容的學生
- 下拉選單顯示所有符合條件的學生姓名
- 避免重複選擇同一學生

### 2. ⏰ 靈活時間設置
- 數字型時間段選擇器
- 格式：HH:MM-HH:MM
- 支持24小時制
- 自動格式化時間顯示

### 3. 📅 便捷日期選擇
- 日曆式日期選擇器
- 默認選擇今天日期
- 支持未來日期選擇

### 4. 📊 完整資料創建
- 自動繼承原始學生資料
- 創建標準格式的雲端記錄
- 包含所有必要欄位
- 日期格式為 YYYY-MM-DD（如：2025-01-28）

### 5. 🔄 自動數量更新
- 創建新待約記錄後，自動更新原始學生
- 將原始學生的"wait"數量減去1
- 保持原有格式，只更新數字部分
- 當數量為0時，清空wait內容

## 使用方法

### 基本操作流程
1. 進入"系統配置"頁面
2. 點擊"➕ 添加待約"按鈕
3. 在彈出窗口中選擇學生姓名
4. 填寫上課時間（開始時間-結束時間）
5. 選擇上課日期
6. 點擊"創建"按鈕完成
7. 系統自動更新原始學生的wait數量

### 詳細步驟

#### 步驟1：選擇學生
- 系統會自動檢查雲端資料庫
- 找出所有有"wait"內容的學生
- 在下拉選單中顯示學生姓名
- 選擇要創建待約記錄的學生

#### 步驟2：設置時間
- 使用數字輸入框設置時間
- 開始時間：時:分
- 結束時間：時:分
- 系統會自動格式化為 HH:MM-HH:MM 格式

#### 步驟3：選擇日期
- 使用日期選擇器
- 默認顯示今天日期
- 可以選擇未來任何日期

#### 步驟4：創建記錄
- 點擊"創建"按鈕
- 系統會自動創建完整的學生記錄
- 上傳到雲端資料庫
- 自動更新原始學生的wait數量
- 顯示創建成功提示

#### 步驟5：數量更新（自動）
- 系統自動找到原始學生的所有記錄
- 解析wait內容中的數字
- 將數量減去1
- 更新雲端資料庫
- 重新加載顯示

## 資料結構

### 創建的記錄包含以下欄位：
```javascript
{
    name: "學生姓名",           // 繼承自原始學生
    phone: "電話號碼",          // 繼承自原始學生
    age: "年齡",               // 繼承自原始學生
    location: "地點",          // 繼承自原始學生
    type: "課程類型",          // 繼承自原始學生
    option1: "",              // 空白
    option2: "",              // 空白
    option3: "",              // 空白
    time: "HH:MM-HH:MM",     // 用戶輸入的時間
    date: "YYYY-MM-DD格式",   // 用戶選擇的日期
    wait: "",                 // 空白
    waitMonth: "",            // 空白
    "上課日期": "YYYY-MM-DD格式" // 用戶選擇的日期
}
```

### Wait數量更新邏輯：
```javascript
// 原始wait內容示例
"待約3堂" -> "待約2堂"
"等待2次" -> "等待1次"
"約課1堂" -> "" (清空)

// 更新規則
- 提取wait內容中的數字
- 減去1
- 如果結果大於0，保持原有格式只更新數字
- 如果結果為0，清空wait內容
```

## 技術特點

### 1. 智能資料獲取
- 自動掃描雲端資料庫
- 過濾有wait內容的學生
- 避免重複學生記錄

### 2. 資料驗證
- 檢查學生是否已選擇
- 驗證時間格式是否完整
- 確認日期是否已選擇

### 3. 自動數量管理
- 智能解析wait內容中的數字
- 自動減去1並更新
- 保持原有格式
- 處理數量為0的情況

### 4. 錯誤處理
- 完善的錯誤提示
- 網絡連接檢查
- 創建失敗重試機制

### 5. 用戶體驗
- 直觀的模態窗口界面
- 清晰的輸入提示
- 即時反饋和狀態更新

## 注意事項

1. **前置條件**：需要先加載雲端資料
2. **學生要求**：只有有"wait"內容的學生才會顯示
3. **時間格式**：必須填寫完整的開始和結束時間
4. **日期選擇**：建議選擇未來日期
5. **資料同步**：創建後會自動重新加載雲端資料
6. **數量更新**：系統會自動更新原始學生的wait數量
7. **格式保持**：更新時會保持原有的wait格式

## 故障排除

### 沒有顯示學生選項
1. 檢查雲端資料是否已加載
2. 確認是否有學生包含"wait"內容
3. 嘗試重新加載雲端資料

### 創建失敗
1. 檢查網絡連接
2. 確認所有必填欄位已填寫
3. 查看控制台錯誤信息

### 時間格式錯誤
1. 確保所有時間欄位都已填寫
2. 檢查時間是否在有效範圍內（0-23小時，0-59分鐘）
3. 確保結束時間晚於開始時間

### Wait數量未更新
1. 檢查原始學生是否有wait內容
2. 確認wait內容包含數字
3. 查看控制台更新日誌

## 更新日誌

### v1.2.0 (2025-01-28)
- ✅ 更新日期格式為 YYYY-MM-DD 格式
- ✅ 添加新的日期格式化函數
- ✅ 優化日期顯示和存儲

### v1.1.0 (2025-01-28)
- ✅ 添加自動更新原始學生wait數量功能
- ✅ 實現智能數字解析和更新
- ✅ 完善數量為0時的處理邏輯
- ✅ 優化更新流程和錯誤處理

### v1.0.0 (2025-01-28)
- ✅ 添加"添加待約"功能
- ✅ 實現智能學生選擇
- ✅ 添加時間和日期選擇器
- ✅ 完善資料驗證和錯誤處理
- ✅ 優化用戶界面和體驗

---

**開發者提示**：如需調試功能，可查看瀏覽器控制台的詳細日誌信息。 
# 教練工時管理功能說明

## 📋 功能概述

教練工時管理頁面是一個專門為教練設計的工時記錄系統，可以幫助教練記錄每日工作時數，並自動計算月度統計信息。

## 🎯 主要功能

### 1. 教練信息顯示
- **教練姓名**：顯示當前登入教練的姓名
- **電話號碼**：顯示教練的聯繫電話
- 信息從 `Coach_account` 資料庫集合中獲取

### 2. 工時記錄管理
- **月份選擇**：可以選擇過去12個月或未來3個月的工時記錄
- **日曆界面**：以日曆形式顯示每日工時輸入框
- **即時輸入**：直接在日曆格子中輸入工時數（支持小數點）
- **自動保存**：修改後自動更新統計信息

### 3. 統計信息
- **總鐘數**：該月所有工作時數的總和
- **工作天數**：有記錄工時的天數
- **平均時數**：總鐘數除以工作天數的平均值

### 4. 數據操作
- **載入工時**：從資料庫載入指定月份的工時記錄
- **保存工時**：將當前修改的工時記錄保存到資料庫
- **導出報表**：生成Excel格式的工時報表

## 🗄️ 資料庫結構

### Coach_account 集合（教練賬號）
```javascript
{
  _id: ObjectId,
  phone: "0912345678",           // 教練電話
  studentPhone: "0912345678",    // 兼容字段
  password: "123456",            // 密碼
  userType: "coach",             // 用戶類型
  studentName: "張教練",         // 教練姓名
  createdAt: 1234567890,         // 創建時間戳
  createdDate: "2024-01-01T00:00:00.000Z"  // 創建日期
}
```

### Coach_work_hours 集合（工時記錄）
```javascript
{
  _id: ObjectId,
  coachPhone: "0912345678",      // 教練電話
  date: "2024-01-15",           // 日期（YYYY-MM-DD格式）
  hours: 6.5,                   // 工時數（支持小數）
  createdAt: Date,              // 創建時間
  updatedAt: Date               // 更新時間
}
```

## 🚀 使用方法

### 1. 訪問教練工時頁面
1. 登入系統後，點擊導航欄中的「教練工時」標籤
2. 系統會自動載入當前教練的信息

### 2. 查看工時記錄
1. 在月份選擇器中選擇要查看的月份
2. 點擊「載入工時」按鈕
3. 系統會顯示該月的日曆界面，已記錄的工時會自動填入

### 3. 記錄工時
1. 在日曆界面中，找到要記錄工時的日期
2. 在對應的輸入框中輸入工時數（如：6.5）
3. 系統會自動更新統計信息

### 4. 保存工時記錄
1. 完成工時輸入後，點擊「保存工時」按鈕
2. 系統會將所有修改保存到資料庫
3. 會顯示保存結果（新增/更新記錄數）

### 5. 導出報表
1. 選擇要導出的月份
2. 點擊「導出報表」按鈕
3. 系統會生成Excel格式的工時報表
4. 報表會保存到桌面的System文件夾中

## 📊 報表內容

導出的Excel報表包含以下信息：

### 標題信息
- 教練姓名和月份
- 生成時間

### 統計信息
- 總鐘數
- 工作天數
- 平均時數

### 詳細記錄
- 日期
- 星期
- 工時

## 🔧 技術實現

### 前端功能
- **日曆生成**：動態生成月曆界面
- **實時統計**：工時修改時自動更新統計
- **數據驗證**：工時輸入範圍限制（0-24小時）
- **響應式設計**：適配不同屏幕尺寸

### 後端功能
- **資料庫連接**：連接MongoDB雲端資料庫
- **數據查詢**：按教練電話和日期範圍查詢工時記錄
- **數據保存**：支持新增和更新工時記錄
- **報表生成**：使用ExcelJS生成Excel報表

### 數據同步
- **實時更新**：前端修改即時反映到統計
- **批量保存**：一次性保存所有修改的記錄
- **錯誤處理**：完善的錯誤提示和處理機制

## 🧪 測試數據

系統已創建測試教練數據：

### 教練賬號
- **電話**：0912345678
- **密碼**：123456
- **姓名**：張教練

### 測試工時記錄
- 已為張教練創建本月的工時記錄
- 包含隨機生成的工時數據
- 可用於測試功能

## 📝 注意事項

1. **工時格式**：支持整數和小數（如：6.5小時）
2. **日期範圍**：只能查看過去12個月和未來3個月的記錄
3. **數據保存**：只有點擊「保存工時」才會真正保存到資料庫
4. **報表導出**：報表會保存到桌面的System文件夾中
5. **網絡連接**：需要穩定的網絡連接來訪問雲端資料庫

## 🔄 更新日誌

### v1.0.0 (2024-01-15)
- ✅ 實現基本的教練工時管理功能
- ✅ 添加日曆界面和統計信息
- ✅ 實現工時記錄的保存和載入
- ✅ 添加Excel報表導出功能
- ✅ 創建測試數據和文檔

## 🆘 故障排除

### 常見問題

1. **無法載入教練信息**
   - 檢查網絡連接
   - 確認教練電話號碼正確
   - 檢查資料庫連接狀態

2. **工時記錄無法保存**
   - 檢查網絡連接
   - 確認資料庫權限
   - 查看控制台錯誤信息

3. **報表導出失敗**
   - 檢查桌面System文件夾權限
   - 確認ExcelJS模組已安裝
   - 檢查磁盤空間

### 調試方法

1. **查看控制台日誌**
   - 按F12打開開發者工具
   - 查看Console標籤的錯誤信息

2. **檢查網絡請求**
   - 在Network標籤中查看API請求狀態
   - 確認請求和響應的數據格式

3. **驗證數據庫連接**
   - 檢查MongoDB連接字符串
   - 確認資料庫集合存在

## 📞 技術支持

如有問題，請檢查：
1. 瀏覽器控制台的錯誤信息
2. 網絡連接狀態
3. 資料庫連接配置
4. 系統日誌文件 